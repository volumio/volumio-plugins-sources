{"version":3,"file":"Misc.js","sourceRoot":"","sources":["../../../src/lib/utils/Misc.ts"],"names":[],"mappings":"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","sourcesContent":["// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport libQ from 'kew';\n\nimport lodash from 'lodash';\nimport * as SystemUtils from './System';\nimport np from '../NowPlayingContext';\n\nconst VOLUMIO_BG_PATH = '/data/backgrounds';\n\nexport function jsPromiseToKew<T>(promise: Promise<T>): any {\n  const defer = libQ.defer();\n\n  promise.then((result) => {\n    defer.resolve(result);\n  })\n    .catch((error) => {\n      defer.reject(error);\n    });\n\n  return defer.promise;\n}\n\nexport function kewToJSPromise(promise: any): Promise<any> {\n  // Guard against a JS promise from being passed to this function.\n  if (typeof promise.catch === 'function' && typeof promise.fail === undefined) {\n    // JS promise - return as is\n    return promise;\n  }\n  return new Promise((resolve, reject) => {\n    promise.then((result: any) => {\n      resolve(result);\n    })\n      .fail((error: any) => {\n        reject(error);\n      });\n  });\n}\n\nexport function getVolumioBackgrounds() {\n  try {\n    return SystemUtils.readdir(VOLUMIO_BG_PATH, 'thumbnail-');\n  }\n  catch (error) {\n    np.getLogger().error(np.getErrorMessage(`[now-playing] Error getting Volumio backgrounds from ${VOLUMIO_BG_PATH}: `, error));\n    np.toast('error', np.getI18n('NOW_PLAYING_GET_VOLUMIO_BG_ERR'));\n    return [];\n  }\n}\n\nexport function rnd(min: number, max: number) {\n  return Math.floor(Math.random() * (max - min) + min);\n}\n\nexport function removeSongNumber(name: string) {\n  // Translates \"8 - Yellow Dog\" to \"Yellow Dog\" for good Match on Genius service.\n  const songNameRegex = /^(?:\\d+\\s*-\\s*)([\\w\\d\\s\\p{L}.()-].+)$/u;\n  const matches = name.match(songNameRegex);\n  const newName = matches && matches?.length > 1 ? matches[1] : name;\n  return newName;\n}\n\nconst mergeSettingsCustomizer = (target: any, src: any): any => {\n  if (target && typeof target === 'object' && !Array.isArray(target)) {\n    return lodash.mergeWith(target, src, mergeSettingsCustomizer);\n  }\n  if (target === undefined || target === null || (typeof target === 'string' && target.trim() === '')) {\n    return src;\n  }\n  return target;\n};\n\nexport function assignObjectEmptyProps<TObject, TSrc1, TSrc2>(object: TObject, src1: TSrc1, src2: TSrc2) {\n  return lodash.mergeWith(object, src1, src2, mergeSettingsCustomizer);\n}\n"]}