{"version":3,"file":"ShowModel.js","sourceRoot":"","sources":["../../../src/lib/model/ShowModel.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,oEAA+C;AAC/C,yEAA0C;AAC1C,4DAAoC;AACpC,8EAAsD;AAQtD,MAAqB,SAAU,SAAQ,mBAAS;IAAhD;;;IA2CA,CAAC;IAzCC,QAAQ,CAAC,MAA+B;QACtC,OAAO,IAAI,CAAC,SAAS,CAAC;YACpB,cAAc,EAAE,EAAE,GAAG,MAAM,EAAE;YAC7B,eAAe,EAAE,uBAAA,IAAI,6DAAsB,CAAC,IAAI,CAAC,IAAI,CAAC;YACtD,uBAAuB,EAAE,uBAAA,IAAI,gEAAyB,CAAC,IAAI,CAAC,IAAI,CAAC;YACjE,eAAe,EAAE,uBAAA,IAAI,mEAA4B,CAAC,IAAI,CAAC,IAAI,CAAC;YAC5D,UAAU,EAAE,MAAM,CAAC,UAAU;YAC7B,SAAS,EAAE,MAAM,CAAC,SAAS;YAC3B,KAAK,EAAE,MAAM,CAAC,KAAK;SACpB,CAAC,CAAC;IACL,CAAC;IAeD,KAAK,CAAC,OAAO,CAAC,OAAe;QAC3B,MAAM,WAAW,GAAG;YAClB,OAAO;YACP,WAAW,EAAE,IAAI,CAAC,mBAAmB,EAAE;SACxC,CAAC;QAEF,MAAM,IAAI,GAAG,MAAM,yBAAQ,CAAC,QAAQ,EAAE,CAAC,QAAQ,CAC7C,IAAI,CAAC,mBAAmB,CAAC,MAAM,EAAE,WAAW,CAAC,EAC7C,GAAG,EAAE,CAAC,wBAAO,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC;QAEnD,OAAO,uBAAA,IAAI,mEAA4B,MAAhC,IAAI,EAA6B,IAAI,CAAC,CAAC;IAChD,CAAC;CAKF;AA3CD,4BA2CC;;IA5BG,MAAM,WAAW,GAAG;QAClB,WAAW,EAAE,IAAI,CAAC,mBAAmB,EAAE;KACxC,CAAC;IACF,OAAO,yBAAQ,CAAC,QAAQ,EAAE,CAAC,QAAQ,CACjC,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE,WAAW,CAAC,EAC9C,GAAG,EAAE,CAAC,wBAAO,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;AAClD,CAAC,mFAEwB,MAAc;IACrC,OAAO,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AACzB,CAAC,yFAe2B,IAAU;IACpC,OAAO,yBAAe,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;AAC3C,CAAC","sourcesContent":["import bcfetch, { Show } from 'bandcamp-fetch';\nimport bandcamp from '../BandcampContext';\nimport BaseModel from './BaseModel';\nimport EntityConverter from '../util/EntityConverter';\n\nexport interface ShowModelGetShowsParams {\n  pageToken?: string;\n  pageOffset?: number;\n  limit: number;\n}\n\nexport default class ShowModel extends BaseModel {\n\n  getShows(params: ShowModelGetShowsParams) {\n    return this.loopFetch({\n      callbackParams: { ...params },\n      getFetchPromise: this.#getShowsFetchPromise.bind(this),\n      getItemsFromFetchResult: this.#getShowsFromFetchResult.bind(this),\n      convertToEntity: this.#convertFetchedShowToEntity.bind(this),\n      pageOffset: params.pageOffset,\n      pageToken: params.pageToken,\n      limit: params.limit\n    });\n  }\n\n  #getShowsFetchPromise() {\n    const queryParams = {\n      imageFormat: this.getAlbumImageFormat()\n    };\n    return bandcamp.getCache().getOrSet(\n      this.getCacheKeyForFetch('shows', queryParams),\n      () => bcfetch.limiter.show.list(queryParams));\n  }\n\n  #getShowsFromFetchResult(result: Show[]) {\n    return result.slice(0);\n  }\n\n  async getShow(showUrl: string) {\n    const queryParams = {\n      showUrl,\n      imageFormat: this.getAlbumImageFormat()\n    };\n\n    const show = await bandcamp.getCache().getOrSet(\n      this.getCacheKeyForFetch('show', queryParams),\n      () => bcfetch.limiter.show.getShow(queryParams));\n\n    return this.#convertFetchedShowToEntity(show);\n  }\n\n  #convertFetchedShowToEntity(item: Show) {\n    return EntityConverter.convertShow(item);\n  }\n}\n"]}