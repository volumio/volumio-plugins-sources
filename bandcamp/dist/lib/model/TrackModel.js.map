{"version":3,"file":"TrackModel.js","sourceRoot":"","sources":["../../../src/lib/model/TrackModel.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,oEAAgD;AAChD,yEAA0C;AAC1C,4DAAoC;AAEpC,8EAAsD;AAEtD,MAAqB,UAAW,SAAQ,mBAAS;IAAjD;;;IA0BA,CAAC;IAxBC,QAAQ,CAAC,QAAgB;QACvB,+DAA+D;QAC/D,gEAAgE;QAChE,gEAAgE;QAChE,OAAO,yBAAQ,CAAC,QAAQ,EAAE,CAAC,QAAQ,CACjC,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE,EAAE,QAAQ,EAAE,CAAC,EAC/C,GAAG,EAAE,CAAC,uBAAA,IAAI,qDAAY,MAAhB,IAAI,EAAa,QAAQ,CAAC,CAAC,CAAC;IACtC,CAAC;CAiBF;AA1BD,6BA0BC;gEAfC,KAAK,iCAAa,QAAgB;IAChC,MAAM,WAAW,GAAG;QAClB,QAAQ;QACR,gBAAgB,EAAE,IAAI,CAAC,mBAAmB,EAAE;QAC5C,iBAAiB,EAAE,IAAI,CAAC,oBAAoB,EAAE;QAC9C,cAAc,EAAE,KAAK;KACtB,CAAC;IACF,MAAM,SAAS,GAAG,MAAM,wBAAO,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;IAEnE,OAAO,uBAAA,IAAI,sEAA6B,MAAjC,IAAI,EAA8B,SAAS,CAAC,CAAC;AACtD,CAAC,6FAE4B,IAAW;IACtC,OAAO,yBAAe,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;AAC5C,CAAC","sourcesContent":["import bcfetch, { Track } from 'bandcamp-fetch';\nimport bandcamp from '../BandcampContext';\nimport BaseModel from './BaseModel';\nimport TrackEntity from '../entities/TrackEntity';\nimport EntityConverter from '../util/EntityConverter';\n\nexport default class TrackModel extends BaseModel {\n\n  getTrack(trackUrl: string) {\n    // Unlike other resources, tracks are converted to TrackEntitys\n    // Before being cached. See also AlbumModel#getAlbum(), where we\n    // Cache an album's tracks that have been converted to entities.\n    return bandcamp.getCache().getOrSet(\n      this.getCacheKeyForFetch('track', { trackUrl }),\n      () => this.#doGetTrack(trackUrl));\n  }\n\n  async #doGetTrack(trackUrl: string) {\n    const queryParams = {\n      trackUrl,\n      albumImageFormat: this.getAlbumImageFormat(),\n      artistImageFormat: this.getArtistImageFormat(),\n      includeRawData: false\n    };\n    const trackInfo = await bcfetch.limiter.track.getInfo(queryParams);\n\n    return this.#convertFetchedTrackToEntity(trackInfo);\n  }\n\n  #convertFetchedTrackToEntity(item: Track): TrackEntity {\n    return EntityConverter.convertTrack(item);\n  }\n}\n"]}