{"version":3,"file":"DiscoverViewHandler.js","sourceRoot":"","sources":["../../../../../src/lib/controller/browse/view-handlers/DiscoverViewHandler.ts"],"names":[],"mappings":"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","sourcesContent":["import { type DiscoverOptions, type DiscoverParams } from 'bandcamp-fetch';\nimport bandcamp from '../../../BandcampContext';\nimport type View from './View';\nimport { type RenderedList, type RenderedPage } from './ViewHandler';\nimport { ModelType } from '../../../model';\nimport ViewHelper from './ViewHelper';\nimport { RendererType } from './renderers';\nimport { type RenderedListItem } from './renderers/BaseRenderer';\nimport { type DiscoverLoopFetchResult, type DiscoveryModelGetDiscoverResultParams } from '../../../model/DiscoverModel';\nimport UIHelper, { type UILink, UI_STYLES } from '../../../util/UIHelper';\nimport ExplodableViewHandler from './ExplodableViewHandler';\nimport type TrackEntity from '../../../entities/TrackEntity';\nimport { type AlbumView } from './AlbumViewHandler';\n\nexport interface DiscoverView extends View {\n  name: 'discover';\n  select?: 'genre' | 'subgenre' | 'sortBy' | 'location' | 'category' | 'time' | 'relatedTag';\n  genre?: string;\n  subgenre?: string;\n  sortBy?: string;\n  location?: string;\n  category?: string;\n  time?: string;\n  customTags?: string;\n}\n\nconst DISCOVER_OPTION_ICONS: Record<string, string> = {\n  genre: 'fa fa-music',\n  subgenre: 'fa fa-filter',\n  sortBy: 'fa fa-sort',\n  location: 'fa fa-map-marker',\n  category: 'fa fa-archive',\n  time: 'fa fa-clock-o',\n  relatedTag: 'fa fa-tag'\n};\n\nexport default class DiscoverViewHandler extends ExplodableViewHandler<DiscoverView> {\n\n  browse(): Promise<RenderedPage> {\n    if (this.currentView.select) {\n      return this.#browseDiscoverOptions();\n    }\n\n    return this.#browseDiscoverResult();\n\n  }\n\n  async #browseDiscoverResult(): Promise<RenderedPage> {\n    const view = this.currentView;\n    const modelParams: DiscoveryModelGetDiscoverResultParams = {\n      discoverParams: this.#getDiscoverParamsFromUriOrDefault(),\n      limit: view.inSection ? bandcamp.getConfigValue('itemsPerSectionDiscover', 11) : bandcamp.getConfigValue('itemsPerPage', 47)\n    };\n\n    if (view.pageRef) {\n      modelParams.pageToken = view.pageRef.pageToken;\n      modelParams.pageOffset = view.pageRef.pageOffset;\n    }\n\n    const model = this.getModel(ModelType.Discover);\n    const discoverResults = await model.getDiscoverResult(modelParams);\n    const discoverOptions = await model.getDiscoverOptions();\n    const lists = [\n      this.#getParamsListFromDiscoverResult(discoverResults.params, discoverOptions),\n      this.#getAlbumsListFromDiscoverResult(discoverResults)\n    ];\n\n    return {\n      navigation: {\n        prev: { uri: this.constructPrevUri() },\n        lists\n      }\n    };\n  }\n\n  #getDiscoverParamsFromUriOrDefault(): DiscoverParams {\n    const view = this.currentView;\n    const params: DiscoverParams = {};\n    if (view.genre) {\n      params.genre = view.genre;\n\n      if (view.subgenre) {\n        params.subgenre = view.subgenre;\n      }\n    }\n    if (view.sortBy) {\n      params.sortBy = view.sortBy;\n    }\n    if (view.location) {\n      params.location = Number(view.location);\n    }\n    if (view.category) {\n      params.category = Number(view.category);\n    }\n    if (view.time) {\n      params.time = parseInt(view.time, 10);\n    }\n    if (view.customTags) {\n      params.customTags = view.customTags.split(',');\n    }\n\n    if (Object.keys(params).length) {\n      return params;\n    }\n\n    const defaultParams = bandcamp.getConfigValue('defaultDiscoverParams', null, true);\n    return defaultParams || {};\n  }\n\n  #getParamsListFromDiscoverResult(_params: DiscoverParams, discoverOptions: DiscoverOptions): RenderedList {\n    const params = {..._params};\n    const defaultAllGenres = !params.genre && (!params.customTags || params.customTags.length === 0);\n    const defaultAllSubgenres = params.genre && !params.subgenre;\n    const baseUri = this.#constructUriWithParams(params);\n    const listItems: RenderedListItem[] = [];\n    [ 'genre', 'subgenre', 'sortBy', 'location', 'category', 'time' ].forEach((o) => {\n      const paramValue = params[o as keyof DiscoverParams];\n      if (paramValue !== undefined || (o === 'genre' && defaultAllGenres) || (o === 'subgenre' && defaultAllSubgenres)) {\n        let optKey;\n        switch (o) {\n          case 'category':\n            optKey = 'categories';\n            break;\n          default:\n            optKey = `${o}s`;\n        }\n        let optArr = discoverOptions[optKey as keyof DiscoverOptions] || [];\n        if (o === 'subgenre') {\n          optArr = params.genre ? (optArr as DiscoverOptions['subgenres'])[params.genre] || [] : [];\n        }\n        if (optArr.length) {\n          const opts = optArr as Array<any>;\n          const opt = opts.find((o: any) => o.value == paramValue);\n          let title;\n          if (o === 'genre' && defaultAllGenres) {\n            title = bandcamp.getI18n('BANDCAMP_ALL_GENRES');\n          }\n          else if (o === 'subgenre' && defaultAllSubgenres) {\n            const genre = discoverOptions.genres.find((g) => g.value === params.genre);\n            title = bandcamp.getI18n('BANDCAMP_ALL_SUBGENRES', genre ? genre.name : params.genre);\n          }\n          else {\n            title = opt ? opt.name : opts[0].name;\n          }\n          listItems.push({\n            service: 'bandcamp',\n            type: 'item-no-menu',\n            title,\n            icon: DISCOVER_OPTION_ICONS[o],\n            uri: `${baseUri}@select=${o}`\n          });\n        }\n      }\n    });\n    if (params.customTags && params.customTags.length > 0) {\n      listItems.unshift({\n        service: 'bandcamp',\n        type: 'item-no-menu',\n        title: bandcamp.getI18n('BANDCAMP_SELECT_RELATEDTAG'),\n        icon: DISCOVER_OPTION_ICONS['relatedTag'],\n        uri: `${baseUri}@select=relatedTag`\n      });\n    }\n    const setDefaultJS = `\n                const params = ${JSON.stringify(params)};\n                const payload = {\n                    'endpoint': 'music_service/bandcamp',\n                    'method': 'saveDefaultDiscoverParams',\n                    'data': params\n                };\n                angular.element('#browse-page').scope().browse.socketService.emit('callMethod', payload);`;\n    const setDefaultLink: UILink = {\n      url: '#',\n      icon: { type: 'fa', class: 'fa fa-cog' },\n      text: bandcamp.getI18n('BANDCAMP_SET_DEFAULT_DISCOVER_PARAMS'),\n      onclick: setDefaultJS.replace(/\"/g, '&quot;').replace(/\\r?\\n|\\r/g, '')\n    };\n\n    const links = [\n      setDefaultLink,\n      this.#getBrowseByTagsLink()\n    ];\n\n    let title;\n    if (params.customTags && params.customTags.length > 0) {\n      title = params.customTags.join(', ');\n    }\n    else {\n      title = UIHelper.constructListTitleWithLink(UIHelper.addBandcampIconToListTitle(bandcamp.getI18n(this.currentView.inSection ? 'BANDCAMP_DISCOVER_SHORT' : 'BANDCAMP_DISCOVER')), links, true);\n    }\n\n    if (!UIHelper.supportsEnhancedTitles()) {\n      // Compensate for loss of 'browse by tags' link\n      const browseByTagsLinkData = this.#getBrowseByTagsLinkData();\n      listItems.push({\n        service: 'bandcamp',\n        type: 'item-no-menu',\n        uri: browseByTagsLinkData.uri,\n        title: browseByTagsLinkData.text,\n        icon: 'fa fa-arrow-circle-right'\n      });\n    }\n\n    return {\n      title,\n      availableListViews: [ 'list' ],\n      items: listItems\n    };\n  }\n\n  #getBrowseByTagsLink(): UILink {\n    const linkData = this.#getBrowseByTagsLinkData();\n\n    return {\n      url: '#',\n      text: linkData.text,\n      onclick: `angular.element('#browse-page').scope().browse.fetchLibrary({uri: '${linkData.uri}'})`,\n      icon: {\n        type: 'fa',\n        class: 'fa fa-arrow-circle-right',\n        float: 'right',\n        color: '#54c688'\n      }\n    };\n  }\n\n  #getBrowseByTagsLinkData() {\n    return {\n      uri: `${this.uri}/tag`,\n      text: bandcamp.getI18n('BANDCAMP_BROWSE_BY_TAGS')\n    };\n  }\n\n  #getAlbumsListFromDiscoverResult(discoverResult: DiscoverLoopFetchResult): RenderedList {\n    const albumRenderer = this.getRenderer(RendererType.Album);\n    const listItems = discoverResult.items.reduce<RenderedListItem[]>((result, album) => {\n      const rendered = albumRenderer.renderToListItem(album);\n      if (rendered) {\n        result.push(rendered);\n      }\n      return result;\n    }, []);\n\n    const nextPageRef = this.constructPageRef(discoverResult.nextPageToken, discoverResult.nextPageOffset);\n    if (nextPageRef) {\n      const nextUri = this.constructNextUri(nextPageRef);\n      listItems.push(this.constructNextPageItem(nextUri));\n    }\n\n    return {\n      availableListViews: [ 'list', 'grid' ],\n      items: listItems\n    };\n  }\n\n  async #browseDiscoverOptions(): Promise<RenderedPage> {\n    const view = this.currentView;\n    const targetOption = view.select;\n    if (!targetOption) {\n      throw Error('Target option missing');\n    }\n\n    const listItems = await (targetOption === 'relatedTag' ? this.#getRelatedTagListItems() : this.#getDiscoverOptionListItems(targetOption));\n    let title = bandcamp.getI18n(`BANDCAMP_SELECT_${targetOption.toUpperCase()}`);\n    title = UIHelper.addIconToListTitle(DISCOVER_OPTION_ICONS[targetOption], title);\n    const lists: RenderedList[] = [ {\n      title,\n      availableListViews: [ 'list' ],\n      items: listItems\n    } ];\n\n    return {\n      navigation: {\n        prev: { uri: this.constructPrevUri() },\n        lists\n      }\n    };\n  }\n\n  async #getDiscoverOptionListItems(targetOption: Required<Exclude<DiscoverView['select'], 'relatedTag'>>) {\n    const discoverOptions = await this.getModel(ModelType.Discover).getDiscoverOptions();\n    let optKey;\n    switch (targetOption) {\n      case 'category':\n        optKey = 'categories';\n        break;\n      default:\n        optKey = `${targetOption}s`;\n    }\n    let optArr = discoverOptions[optKey as keyof DiscoverOptions] || [];\n    const view = this.currentView;\n    if (targetOption === 'subgenre' && optArr) {\n      optArr = view.genre ? (optArr as DiscoverOptions['subgenres'])[view.genre] || [] : [];\n    }\n    const listItems = (optArr as Array<any>).map<RenderedListItem>((opt) => {\n      const isSelected = opt.value == view[view.select as keyof DiscoverView];\n      let title = opt.name;\n      if (isSelected) {\n        title = UIHelper.styleText(title, UI_STYLES.LIST_ITEM_SELECTED);\n      }\n\n      return {\n        service: 'bandcamp',\n        type: 'item-no-menu',\n        title,\n        icon: isSelected ? 'fa fa-check' : 'fa',\n        uri: this.#constructDiscoverOptionUri(targetOption as string, opt.value)\n      };\n    });\n\n    if (targetOption === 'genre') {\n      const isSelected = !view.genre;\n      let title = bandcamp.getI18n('BANDCAMP_ALL_GENRES');\n      if (isSelected) {\n        title = UIHelper.styleText(title, UI_STYLES.LIST_ITEM_SELECTED);\n      }\n      listItems.unshift({\n        service: 'bandcamp',\n        type: 'item-no-menu',\n        title,\n        icon: isSelected ? 'fa fa-check' : 'fa',\n        uri: this.#constructDiscoverOptionUri(targetOption as string, undefined)\n      });\n    }\n\n    if (targetOption === 'subgenre' && view.genre) {\n      const isSelected = !view.subgenre;\n      const genre = discoverOptions.genres.find((g) => g.value === view.genre);\n      let title = bandcamp.getI18n('BANDCAMP_ALL_SUBGENRES', genre ? genre.name : view.genre);\n      if (isSelected) {\n        title = UIHelper.styleText(title, UI_STYLES.LIST_ITEM_SELECTED);\n      }\n      listItems.unshift({\n        service: 'bandcamp',\n        type: 'item-no-menu',\n        title,\n        icon: isSelected ? 'fa fa-check' : 'fa',\n        uri: this.#constructDiscoverOptionUri(targetOption as string, undefined)\n      });\n    }\n\n    return listItems;\n  }\n\n  async #getRelatedTagListItems() {\n    const view = this.currentView;\n    const customTags = view.customTags?.split(',') || [];\n    if (customTags.length === 0) {\n      throw Error('No target tags specified');\n    }\n    const model = this.getModel(ModelType.Tag);\n    const relatedTags = model.getRelatedTags(customTags);\n    const listItems = (await relatedTags).map<RenderedListItem>((tag) => {\n      const added = [ ...customTags, tag.value ];\n      return {\n        service: 'bandcamp',\n        type: 'item-no-menu',\n        title: tag.name,\n        icon: 'fa',\n        uri: this.#constructDiscoverOptionUri('customTags', added.join(','))\n      };\n    });\n\n    return listItems;\n  }\n\n  #constructDiscoverOptionUri(option: string, value?: string) {\n    const targetView = {\n      ...this.currentView\n    };\n    if (this.currentView[option] !== value) {\n      delete targetView.pageRef;\n      delete targetView.prevPageRefs;\n      if (value !== undefined) {\n        targetView[option] = value;\n      }\n      else {\n        delete targetView[option];\n      }\n    }\n    delete targetView.select;\n\n    return ViewHelper.constructUriFromViews([\n      ...this.previousViews,\n      targetView\n    ]);\n  }\n\n  #constructUriWithParams(params: object) {\n    const targetView = {\n      ...this.currentView,\n      ...params\n    };\n    return ViewHelper.constructUriFromViews([\n      ...this.previousViews,\n      targetView\n    ]);\n  }\n\n  protected async getTracksOnExplode() {\n    const view = this.currentView;\n    const modelParams: DiscoveryModelGetDiscoverResultParams = {\n      discoverParams: this.#getDiscoverParamsFromUriOrDefault(),\n      limit: bandcamp.getConfigValue('itemsPerPage', 47)\n    };\n    const model = this.getModel(ModelType.Discover);\n    const discoverResults = await model.getDiscoverResult(modelParams);\n    const tracks = discoverResults.items.reduce<TrackEntity[]>((result, album) => {\n      const featured = album.featuredTrack;\n      if (featured?.streamUrl && featured.id) {\n        result.push({\n          type: 'track',\n          id: featured.id,\n          name: featured.name,\n          url: album.url,\n          thumbnail: album.thumbnail,\n          artist: album.artist,\n          album: {\n            type: 'album',\n            name: album.name,\n            url: album.url\n          },\n          streamUrl: featured.streamUrl\n        });\n      }\n      return result;\n    }, []);\n\n    return tracks;\n  }\n\n  /**\n   * Override\n   *\n   * Add track uri:\n   * - bandcamp/album@albumUrl={...}@trackId={...}@artistUrl={...}\n   */\n  getTrackUri(track: TrackEntity) {\n    const artistUrl = track.artist?.url || null;\n    const albumUrl = track.album?.url || artistUrl;\n\n    if (track.album && albumUrl) {\n      const albumView: AlbumView = {\n        name: 'album',\n        albumUrl\n      };\n      if (track.id) {\n        albumView.trackId = String(track.id);\n      }\n      if (artistUrl) {\n        albumView.artistUrl = artistUrl;\n      }\n\n      return `bandcamp/${ViewHelper.constructUriSegmentFromView(albumView)}`;\n    }\n\n    return super.getTrackUri(track);\n  }\n}\n"]}