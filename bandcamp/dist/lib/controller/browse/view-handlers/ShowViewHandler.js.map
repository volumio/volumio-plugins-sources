{"version":3,"file":"ShowViewHandler.js","sourceRoot":"","sources":["../../../../../src/lib/controller/browse/view-handlers/ShowViewHandler.ts"],"names":[],"mappings":"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","sourcesContent":["import bandcamp from '../../../BandcampContext';\nimport TrackEntity from '../../../entities/TrackEntity';\nimport { ModelType } from '../../../model';\nimport { ShowModelGetShowsParams } from '../../../model/ShowModel';\nimport UIHelper, { UILink } from '../../../util/UIHelper';\nimport ExplodableViewHandler from './ExplodableViewHandler';\nimport View from './View';\nimport { RenderedList, RenderedPage } from './ViewHandler';\nimport ViewHelper from './ViewHelper';\nimport { RendererType } from './renderers';\nimport { RenderedListItem } from './renderers/BaseRenderer';\n\nexport interface ShowView extends View {\n  name: 'show';\n  showUrl: string;\n  view?: 'albums' | 'tracks';\n}\n\ninterface ShowExplodeTrack extends TrackEntity {\n  showUrl: string;\n}\n\nexport default class ShowViewHandler extends ExplodableViewHandler<ShowView> {\n\n  async browse(): Promise<RenderedPage> {\n    const showUrl = this.currentView.showUrl;\n    if (showUrl) {\n      return this.#browseShow(showUrl);\n    }\n\n    return this.#browseAllShows();\n  }\n\n  async #browseAllShows(): Promise<RenderedPage> {\n    const view = this.currentView;\n\n    const modelParams: ShowModelGetShowsParams = {\n      limit: view.inSection ? bandcamp.getConfigValue('itemsPerSection', 5) : bandcamp.getConfigValue('itemsPerPage', 47)\n    };\n\n    if (view.pageRef) {\n      modelParams.pageToken = view.pageRef.pageToken;\n      modelParams.pageOffset = view.pageRef.pageOffset;\n    }\n\n    const shows = await this.getModel(ModelType.Show).getShows(modelParams);\n    const showRenderer = this.getRenderer(RendererType.Show);\n    const listItems = shows.items.reduce<RenderedListItem[]>((result, show) => {\n      const rendered = showRenderer.renderToListItem(show);\n      if (rendered) {\n        result.push(rendered);\n      }\n      return result;\n    }, []);\n\n    const nextPageRef = this.constructPageRef(shows.nextPageToken, shows.nextPageOffset);\n    if (nextPageRef) {\n      const nextUri = this.constructNextUri(nextPageRef);\n      listItems.push(this.constructNextPageItem(nextUri));\n    }\n\n    return {\n      navigation: {\n        prev: { uri: this.constructPrevUri() },\n        lists: [ {\n          title: UIHelper.addBandcampIconToListTitle(bandcamp.getI18n(view.inSection ? 'BANDCAMP_SHOWS_SHORT' : 'BANDCAMP_SHOWS')),\n          availableListViews: [ 'list', 'grid' ],\n          items: listItems\n        } ]\n      }\n    };\n  }\n\n  async #browseShow(showUrl: string): Promise<RenderedPage> {\n    const view = this.currentView;\n    const trackModel = this.getModel(ModelType.Track);\n    const allLists: RenderedList[] = [];\n\n    const show = await this.getModel(ModelType.Show).getShow(showUrl);\n    const showRenderer = this.getRenderer(RendererType.Show);\n    const showListItem = showRenderer.renderToListItem(show, true);\n    if (showListItem) {\n      const viewShowExternalLink: UILink = {\n        url: showUrl,\n        text: bandcamp.getI18n('BANDCAMP_VIEW_LINK_SHOW'),\n        icon: { type: 'bandcamp' },\n        target: '_blank'\n      };\n      const playFullStreamLinkList: RenderedList = {\n        title: UIHelper.constructListTitleWithLink('', viewShowExternalLink, true),\n        availableListViews: [ 'list' ],\n        items: [ showListItem ]\n      };\n      allLists.push(playFullStreamLinkList);\n    }\n\n    if (view.view === 'albums') {\n      const albumRenderer = this.getRenderer(RendererType.Album);\n      const trackRenderer = this.getRenderer(RendererType.Track);\n      const switchViewLinkData = {\n        uri: this.#constructUriWithParams({ view: 'tracks', noExplode: 1 }),\n        text: bandcamp.getI18n('BANDCAMP_SHOW_FEATURED_TRACKS')\n      };\n      const switchViewLink: UILink = {\n        url: '#',\n        text: switchViewLinkData.text,\n        onclick: `angular.element('#browse-page').scope().browse.fetchLibrary({uri: '${switchViewLinkData.uri}'}, true)`,\n        icon: {\n          type: 'fa',\n          class: 'fa fa-arrow-circle-right',\n          float: 'right',\n          color: '#54c688'\n        }\n      };\n      const featuredAlbumsList: RenderedList = {\n        title: UIHelper.constructListTitleWithLink(bandcamp.getI18n('BANDCAMP_TRACK_SOURCES'), switchViewLink, false),\n        availableListViews: [ 'list', 'grid' ],\n        items: []\n      };\n\n      const _fetchAlbumOrTrackPromise = async (track: TrackEntity) => {\n        if (track.album) {\n          return track.album;\n        }\n        else if (track.url) {\n          try {\n            return await trackModel.getTrack(track.url);\n          }\n          catch (error: any) {\n            return null;\n          }\n        }\n        return null;\n      };\n\n      const fetchAlbumOrTrackPromises = show.tracks?.map((track) => _fetchAlbumOrTrackPromise(track)) || [];\n\n      const fetchedAlbumsOrTracks = (await Promise.all(fetchAlbumOrTrackPromises));\n      const albumsAdded: string[] = [];\n\n      fetchedAlbumsOrTracks.forEach((item) => {\n        if (!item?.url) {\n          return true;\n        }\n        if (item.type === 'track') {\n          const rendered = trackRenderer.renderToListItem(item, true, true);\n          if (rendered) {\n            featuredAlbumsList.items.push(rendered);\n          }\n        }\n        else if (item.type === 'album' && !albumsAdded.includes(item.url)) {\n          const rendered = albumRenderer.renderToListItem(item);\n          if (rendered) {\n            featuredAlbumsList.items.push(rendered);\n            albumsAdded.push(item.url);\n          }\n        }\n      });\n\n      allLists.push(featuredAlbumsList);\n      this.#checkAndAddSwitchViewListItem(switchViewLinkData, allLists);\n    }\n    else {\n      const trackRenderer = this.getRenderer(RendererType.Track);\n      const switchViewLinkData = {\n        uri: this.#constructUriWithParams({ view: 'albums', noExplode: 1 }),\n        text: bandcamp.getI18n('BANDCAMP_SHOW_TRACK_SOURCES')\n      };\n      const switchViewLink: UILink = {\n        url: '#',\n        text: switchViewLinkData.text,\n        onclick: `angular.element('#browse-page').scope().browse.fetchLibrary({uri: '${switchViewLinkData.uri}'}, true)`,\n        icon: {\n          type: 'fa',\n          class: 'fa fa-arrow-circle-right',\n          float: 'right',\n          color: '#54c688'\n        }\n      };\n      const featuredTracksList: RenderedList = {\n        title: UIHelper.constructListTitleWithLink(bandcamp.getI18n('BANDCAMP_FEATURED_TRACKS'), switchViewLink, false),\n        availableListViews: [ 'list' ],\n        items: []\n      };\n      const fetchTrackPromises = show.tracks?.map(async (track) => {\n        try {\n          if (track.url) {\n            return await trackModel.getTrack(track.url);\n          }\n          return null;\n        }\n        catch (error: any) {\n          return null;\n        }\n      });\n      const tracks = fetchTrackPromises ? await Promise.all(fetchTrackPromises) : [];\n\n      tracks.forEach((track) => {\n        if (track) {\n          const rendered = trackRenderer.renderToListItem(track);\n          if (rendered) {\n            featuredTracksList.items.push(rendered);\n          }\n        }\n      });\n      allLists.push(featuredTracksList);\n      this.#checkAndAddSwitchViewListItem(switchViewLinkData, allLists);\n    }\n\n    return {\n      navigation: {\n        prev: { uri: this.constructPrevUri() },\n        info: showRenderer.renderToHeader(show),\n        lists: allLists\n      }\n    };\n  }\n\n  #constructUriWithParams(params: object) {\n    const targetView = {\n      ...this.currentView,\n      ...params\n    };\n    return ViewHelper.constructUriFromViews([\n      ...this.previousViews,\n      targetView\n    ]);\n  }\n\n  #checkAndAddSwitchViewListItem(linkData: { uri: string; text: string }, allLists: RenderedList[]) {\n    if (!UIHelper.supportsEnhancedTitles()) {\n      // Compensate for loss of switch view link\n      const switchViewListItem: RenderedListItem = {\n        service: 'bandcamp',\n        type: 'item-no-menu',\n        uri: linkData.uri,\n        title: linkData.text,\n        icon: 'fa fa-arrow-circle-right'\n      };\n      allLists.push({\n        availableListViews: [ 'list' ],\n        items: [ switchViewListItem ]\n      });\n    }\n    return allLists;\n  }\n\n  async getTracksOnExplode(): Promise<ShowExplodeTrack | ShowExplodeTrack[]> {\n    const showUrl = this.currentView.showUrl;\n    if (!showUrl) {\n      throw Error('Show URL missing');\n    }\n\n    const show = await this.getModel(ModelType.Show).getShow(showUrl);\n    return {\n      type: 'track',\n      name: show.name,\n      streamUrl: show.streamUrl,\n      thumbnail: show.thumbnail,\n      artist: {\n        type: 'artist',\n        name: UIHelper.reformatDate(show.date)\n      },\n      album: {\n        type: 'album',\n        name: bandcamp.getI18n('BANDCAMP_HEADER_SHOW')\n      },\n      showUrl: show.url\n    };\n  }\n\n  /**\n   * Override\n   *\n   * Track uri:\n   * bandcamp/show@showUrl={showUrl}\n   */\n  getTrackUri(track: ShowExplodeTrack) {\n    const showView: ShowView = {\n      name: 'show',\n      showUrl: track.showUrl\n    };\n    return `bandcamp/${ViewHelper.constructUriSegmentFromView(showView)}`;\n  }\n}\n"]}