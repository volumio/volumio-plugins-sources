{"version":3,"file":"FeedViewHandler.js","sourceRoot":"","sources":["../../../../../src/lib/controller/browse/view-handlers/FeedViewHandler.ts"],"names":[],"mappings":"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","sourcesContent":["import ytmusic from '../../../YTMusicContext';\nimport { ContentItem, PageElement } from '../../../types';\nimport Endpoint, { BrowseContinuationEndpoint, BrowseEndpoint, EndpointType, SearchContinuationEndpoint, SearchEndpoint, WatchEndpoint } from '../../../types/Endpoint';\nimport ExplodableViewHandler from './ExplodableViewHandler';\nimport View, { ContinuationBundle } from './View';\nimport { RenderedList, RenderedPage } from './ViewHandler';\nimport { RendererType } from './renderers';\nimport { RenderedHeader, RenderedListItem } from './renderers/BaseRenderer';\nimport { ContinuationBundleOption } from './renderers/OptionRenderer';\nimport { SectionItem } from '../../../types/PageElement';\nimport AutoplayHelper from '../../../util/AutoplayHelper';\nimport EndpointHelper from '../../../util/EndpointHelper';\nimport { PageContent } from '../../../types/Content';\n\n/**\n * View handler for feed contents consisting of sections and optional header.\n */\n\nexport interface FeedView extends View {\n  endpoint?: BrowseEndpoint | BrowseContinuationEndpoint | SearchEndpoint | SearchContinuationEndpoint | WatchEndpoint;\n}\n\ntype RenderableItem = ContentItem.Channel |\n  ContentItem.EndpointLink |\n  ContentItem.Album |\n  ContentItem.Playlist |\n  ContentItem.MusicItem |\n  PageElement.Option |\n  ContinuationBundleOption;\n\nexport default abstract class FeedViewHandler<V extends FeedView = FeedView> extends ExplodableViewHandler<V> {\n\n  async browse(): Promise<RenderedPage> {\n    const contents = await this.getContents();\n\n    if (!contents) {\n      throw Error('No contents');\n    }\n\n    this.applyContinuationBundle(contents);\n\n    const header = this.getHeader(contents.header);\n    const lists: RenderedList[] = [];\n\n    contents?.sections?.forEach((section) => {\n      lists.push(...this.#sectionToLists(contents, section, header));\n    });\n\n    if (lists.length === 0) {\n      lists.push({\n        availableListViews: [ 'list' ],\n        items: []\n      });\n    }\n\n    if (!lists[0].title && !header && contents.header?.title) {\n      lists[0].title = contents.header.title;\n    }\n\n    const nav: RenderedPage['navigation'] = {\n      info: header,\n      prev: {\n        uri: this.constructPrevUri()\n      },\n      lists\n    };\n\n    if (contents.tabs) {\n      // Don't show single tab, but use its title where appropriate\n      if (contents.tabs.length === 1) {\n        const tabTitle = contents.tabs[0].text;\n        if (tabTitle && lists[0] && !lists[0].title) {\n          lists[0].title = tabTitle;\n        }\n      }\n      else {\n        const tabsToListItem = this.renderToListItem(this.#createOptionFromTabs(contents.tabs), contents);\n        if (tabsToListItem) {\n          if (lists[0].isFiltersAndButtons) {\n            lists[0].items.unshift(tabsToListItem);\n          }\n          else {\n            lists.unshift({\n              availableListViews: [ 'list' ],\n              items: [ tabsToListItem ]\n            });\n          }\n        }\n      }\n    }\n\n    return { navigation: nav };\n  }\n\n  #sectionToLists(contents: PageContent, section: PageElement.Section, header?: RenderedHeader | null, parentContinuationBundle?: ContinuationBundle): RenderedList[] {\n    const listsForSection: RenderedList[] = [];\n    const continuationBundle = this.createContinuationBundle(contents, section);\n    const passOnBundle = JSON.parse(JSON.stringify(continuationBundle));\n    if (parentContinuationBundle) {\n      if (!passOnBundle.section.filters) {\n        passOnBundle.section.filters = parentContinuationBundle.section.filters;\n        passOnBundle.section.filtersFromParent = true;\n      }\n      if (!passOnBundle.section.buttons) {\n        passOnBundle.section.buttons = parentContinuationBundle.section.buttons;\n        passOnBundle.section.buttonsFromParent = true;\n      }\n    }\n    let hasNestedSections = false; // Talking about nested sections with actual contents\n\n    // List: section main items\n    const mainItems: RenderedListItem[] = [];\n    const commonAutoplayContext = AutoplayHelper.getAutoplayContext(section.items.filter((item) => item.type !== 'section'));\n    // Disregard nested section when determining if every item is song / video, because\n    // The nested section will be converted to separate list(s).\n    const isAllMusicItems = section.items.every((item) => item.type === 'section' || item.type === 'song' || item.type === 'video');\n    section.items?.forEach((item) => {\n      if (item.type === 'section') {\n        const nestedSectionToLists = this.#sectionToLists(contents, item, header, passOnBundle);\n        if (nestedSectionToLists.length > 0) {\n          listsForSection.push(...nestedSectionToLists);\n          hasNestedSections = true;\n        }\n      }\n      else {\n        const isMusicItem = item.type === 'video' || item.type === 'song';\n        if (isMusicItem) {\n          const autoplayContext = commonAutoplayContext || AutoplayHelper.getAutoplayContext(item);\n          if (autoplayContext) {\n            item.autoplayContext = autoplayContext;\n          }\n        }\n        const listItem = this.renderToListItem(item, contents);\n        if (listItem) {\n          if (isMusicItem && !isAllMusicItems) {\n            // Setting type to 'album' ensures only this item will get exploded when clicked. The exception\n            // Is when listing songs / videos in a playlist.\n            listItem.type = 'album';\n          }\n          mainItems.push(listItem);\n        }\n      }\n    });\n\n    if (mainItems.length > 0) {\n      listsForSection.unshift({\n        availableListViews: this.getAvailableListViews(section),\n        items: mainItems\n      });\n    }\n\n    // Section title\n    const prevItemCount = this.#getContinuationPrevItemCount();\n    const currentItemCount = prevItemCount + mainItems.length;\n    const isNextContinuation = EndpointHelper.isType(section.continuation?.endpoint, EndpointType.BrowseContinuation, EndpointType.SearchContinuation);\n    const showingResultsText = mainItems.length > 0 && (isNextContinuation ||\n      (contents.type === 'page' && contents.isContinuation && prevItemCount > 0)) ?\n      ytmusic.getI18n('YTMUSIC_SHOWING_RESULTS', prevItemCount + 1, currentItemCount) : null;\n    let sectionTitle = section.title /*|| (!header ? contents.header?.title : undefined)*/;\n    if (section.subtitle) {\n      sectionTitle = sectionTitle ? `${sectionTitle}: ${section.subtitle}` : section.subtitle;\n    }\n    if (showingResultsText) {\n      if (!sectionTitle && !header && contents.header?.title) {\n        sectionTitle = contents.header.title;\n      }\n      if (sectionTitle) {\n        sectionTitle = `${sectionTitle} (${showingResultsText.charAt(0).toLocaleLowerCase()}${showingResultsText.substring(1)})`;\n      }\n      else {\n        sectionTitle = showingResultsText;\n      }\n    }\n\n    if (section.continuation) {\n      const continuationItem = this.constructContinuationItem({\n        continuation: section.continuation,\n        prevItemCount: isNextContinuation ? currentItemCount : 0,\n        bundle: passOnBundle\n      });\n      if (!hasNestedSections) {\n        mainItems.push(continuationItem);\n      }\n      else {\n        listsForSection.push({\n          availableListViews: [ 'list' ],\n          items: [ continuationItem ]\n        });\n      }\n    }\n\n    const dataStartItems: RenderableItem[] = [];\n    const dataEndItems: RenderableItem[] = [];\n\n    // List: section start items\n    // -- Filters\n    if (continuationBundle.section?.filters) {\n      // Check if selected filter has an endpoint and if none, set it to current.\n      const view = this.currentView;\n      const currentViewEndpoint = view.endpoint || null;\n      if (EndpointHelper.isType(currentViewEndpoint,\n        EndpointType.Browse, EndpointType.BrowseContinuation,\n        EndpointType.Search, EndpointType.SearchContinuation)) {\n        continuationBundle.section.filters.forEach((filter) => {\n          const selected = filter.optionValues.find((ov) => ov.selected);\n          if (selected && !selected.endpoint) {\n            selected.endpoint = currentViewEndpoint;\n          }\n        });\n      }\n      continuationBundle.section.filters.forEach((filter, index) => {\n        dataStartItems.push(this.#createContinuationBundleOption(continuationBundle, `section.filters.${index}`));\n      });\n    }\n\n    // -- Buttons\n    if (continuationBundle.section?.buttons) {\n      const defaultDest = dataStartItems.length === 0 ? dataStartItems : dataEndItems;\n      continuationBundle.section.buttons.forEach((button) => {\n        const buttonEndpointItem: ContentItem.EndpointLink = {\n          type: 'endpointLink',\n          title: button.text,\n          endpoint: button.endpoint\n        };\n        switch (button.placement) {\n          case 'top':\n            dataStartItems.push(buttonEndpointItem);\n            break;\n          case 'bottom':\n            dataEndItems.push(buttonEndpointItem);\n            break;\n          default:\n            defaultDest.push(buttonEndpointItem);\n        }\n      });\n    }\n\n    const startItems = dataStartItems.reduce<RenderedListItem[]>((rendered, data) => {\n      const listItem = this.renderToListItem(data, contents);\n      if (listItem) {\n        rendered.push(listItem);\n      }\n      return rendered;\n    }, []);\n\n    const endItems = dataEndItems.reduce<RenderedListItem[]>((rendered, data) => {\n      const listItem = this.renderToListItem(data, contents);\n      if (listItem) {\n        rendered.push(listItem);\n      }\n      return rendered;\n    }, []);\n\n    if (startItems.length > 0) {\n      listsForSection.unshift({\n        availableListViews: [ 'list' ],\n        items: [ ...startItems ],\n        isFiltersAndButtons: true\n      });\n    }\n\n    if (endItems.length > 0) {\n      listsForSection.push({\n        availableListViews: [ 'list' ],\n        items: [ ...endItems ],\n        isFiltersAndButtons: true\n      });\n    }\n\n    // Set section title\n    if (listsForSection.length > 0 && !listsForSection[0].title) {\n      listsForSection[0].title = sectionTitle;\n    }\n\n    const hasChipCloudTypeFilter = section.filters ? section.filters.some((filter) => filter.subtype === 'chipCloud') : false;\n\n    if (mainItems.length === 0 && !hasNestedSections && (sectionTitle || hasChipCloudTypeFilter)) {\n      listsForSection.push({\n        title: sectionTitle,\n        availableListViews: [ 'list' ],\n        items: []\n      });\n    }\n\n    return listsForSection;\n  }\n\n  protected abstract getContents(): Promise<PageContent | null>;\n\n  getHeader(data?: PageElement.Header): RenderedHeader | null {\n    if (!data) {\n      return null;\n    }\n\n    switch (data.type) {\n      case 'channel':\n        return this.getRenderer(RendererType.Channel).renderToHeader(data);\n      case 'playlist':\n        return this.getRenderer(RendererType.Playlist).renderToHeader(data as PageElement.PlaylistHeader);\n      case 'album':\n        return this.getRenderer(RendererType.Album).renderToHeader(data as PageElement.AlbumHeader);\n      default:\n        return null;\n    }\n  }\n\n  // Creates a bundle that passes to the next continuation of the specified section.\n  // The bundle gets appended to the continuation uri and shall ultimately be passed\n  // Back to this handler, which will then apply the bundle to the continuation contents\n  // Before creating the view.\n  createContinuationBundle(contents: PageContent, section: PageElement.Section): ContinuationBundle {\n    const bundle = {\n      section: {\n        title: section.title || null,\n        subtitle: section.subtitle || null,\n        filters: section.filters || null,\n        buttons: section.buttons || null,\n        filtersFromParent: false,\n        buttonsFromParent: false\n      },\n      contents: {\n        header: contents.header || null,\n        tabs: contents.tabs || null\n      }\n    };\n\n    return bundle;\n  }\n\n  applyContinuationBundle(contents: PageContent) {\n    if (!contents.isContinuation) {\n      return false;\n    }\n\n    const view = this.currentView;\n    const bundle = view.continuationBundle || null;\n\n    if (!bundle || !contents) {\n      return false;\n    }\n\n    if (bundle.contents?.header && !contents.header) {\n      contents.header = bundle.contents.header;\n    }\n\n    if (bundle.contents?.tabs && !contents.tabs) {\n      contents.tabs = bundle.contents.tabs;\n    }\n\n    if (bundle && contents?.sections && !contents.isReload) {\n      const continuationSection = contents.sections[0];\n      if (continuationSection) {\n        const firstItemIsSection = continuationSection.items?.[0]?.type === 'section';\n        if (bundle.section?.title && !firstItemIsSection && !continuationSection.title) {\n          continuationSection.title = bundle.section.title;\n          if (bundle.section.subtitle) {\n            continuationSection.subtitle = bundle.section.subtitle;\n          }\n        }\n        let targetSectionForFilters = continuationSection;\n        let targetSectionForButtons = continuationSection;\n        if (bundle.section?.filtersFromParent || bundle.section?.buttonsFromParent) {\n          const parentSection: PageElement.Section = {\n            type: 'section',\n            items: [ continuationSection ]\n          };\n          contents.sections[0] = parentSection;\n          if (bundle.section.filtersFromParent) {\n            targetSectionForFilters = parentSection;\n          }\n          if (bundle.section.buttonsFromParent) {\n            targetSectionForButtons = parentSection;\n          }\n        }\n        if (bundle.section?.filters) {\n          targetSectionForFilters.filters = bundle.section.filters;\n        }\n        if (bundle.section?.buttons) {\n          targetSectionForButtons.buttons = bundle.section.buttons;\n        }\n      }\n    }\n\n    return true;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  protected renderToListItem(data: RenderableItem, contents: PageContent): RenderedListItem | null {\n    switch (data.type) {\n      case 'channel':\n        return this.getRenderer(RendererType.Channel).renderToListItem(data);\n      case 'endpointLink':\n        return this.getRenderer(RendererType.EndpointLink).renderToListItem(data);\n      case 'playlist':\n        return this.getRenderer(RendererType.Playlist).renderToListItem(data);\n      case 'album':\n        return this.getRenderer(RendererType.Album).renderToListItem(data);\n      case 'video':\n      case 'song':\n        return this.getRenderer(RendererType.MusicItem).renderToListItem(data);\n      case 'option':\n      case 'continuationBundleOption':\n        return this.getRenderer(RendererType.Option).renderToListItem(data);\n      default:\n        return null;\n    }\n  }\n\n  protected getAvailableListViews(section: PageElement.Section): RenderedList['availableListViews'] {\n    const items = section.items.filter((item) => item.type !== 'section');\n\n    if (items.every((item) => item.type === 'channel' || item.type === 'album' || item.type === 'playlist')) {\n      return [ 'grid' ];\n    }\n\n    if (section.itemLayout !== undefined) {\n      return [ section.itemLayout ];\n    }\n\n    // Note: Volumio only enforces availableListViews = ['list']. If a list is set to ['grid'], it can still be switched to list\n    // If there are other switchable lists and the user clicks the switch view button.\n    const isBrowseEndpointLinkWithIcon = (item: PageElement.SectionItem) =>\n      item.type === 'endpointLink' &&\n      item.icon && !item.icon.startsWith('YTMUSIC_') &&\n      !EndpointHelper.isType(item.endpoint, EndpointType.Watch);\n\n    if (items.length === 0 ||\n      !items.some((item) => item.type !== 'section' && isBrowseEndpointLinkWithIcon(item)) ||\n      items.every((item) => item.type === 'song')) {\n      return [ 'list' ];\n    }\n\n    return [ 'list', 'grid' ];\n  }\n\n  #getContinuationPrevItemCount() {\n    const continuation = this.currentView.continuation;\n    if (continuation) {\n      return continuation.prevItemCount || 0;\n    }\n    return 0;\n  }\n\n  #createContinuationBundleOption(bundle: ContinuationBundle, targetKey: string): ContinuationBundleOption {\n    return {\n      type: 'continuationBundleOption',\n      continuationBundle: bundle,\n      targetKey\n    };\n  }\n\n  #createOptionFromTabs(tabs: PageElement.Tab[]): PageElement.Option {\n    return {\n      type: 'option',\n      subtype: 'tab',\n      optionValues: tabs\n    };\n  }\n\n  protected findAllItemsInSection(target: PageElement.Section | PageElement.Section[], predicate?: (item: SectionItem) => boolean): SectionItem[] {\n    if (!target) {\n      return [];\n    }\n\n    if (Array.isArray(target)) {\n      return target.reduce<SectionItem[]>((result, section) => {\n        result.push(...this.findAllItemsInSection(section, predicate));\n        return result;\n      }, []);\n    }\n\n    const result: SectionItem[] = [];\n    target.items?.forEach((item) => {\n      if (item.type === 'section') {\n        result.push(...this.findAllItemsInSection(item, predicate));\n      }\n      else if (typeof predicate !== 'function' || predicate(item)) {\n        result.push(item);\n      }\n    });\n\n    return result;\n  }\n\n  protected findAllEndpointsInSection<T extends Endpoint>(target?: PageElement.Section | PageElement.Section[], predicate?: (endpoint: Endpoint) => boolean): T[] {\n    if (!target) {\n      return [];\n    }\n\n    const __applyPredicate = (endpoint: Endpoint): endpoint is T => {\n      if (typeof predicate !== 'function') {\n        return true;\n      }\n      return predicate(endpoint);\n    };\n\n    if (Array.isArray(target)) {\n      return target.reduce<T[]>((result, section) => {\n        result.push(...this.findAllEndpointsInSection<T>(section, predicate));\n        return result;\n      }, []);\n    }\n\n    const result: T[] = [];\n    const haystack = [\n      ...target.buttons || [],\n      ...target.items\n    ];\n\n    for (const needle of haystack) {\n      if (needle.type === 'section') {\n        result.push(...this.findAllEndpointsInSection<T>(needle, predicate));\n      }\n      else if (needle.endpoint && __applyPredicate(needle.endpoint)) {\n        result.push(needle.endpoint);\n      }\n    }\n\n    return result;\n  }\n}\n"]}