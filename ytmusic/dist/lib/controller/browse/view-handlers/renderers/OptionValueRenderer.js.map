{"version":3,"file":"OptionValueRenderer.js","sourceRoot":"","sources":["../../../../../../src/lib/controller/browse/view-handlers/renderers/OptionValueRenderer.ts"],"names":[],"mappings":"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","sourcesContent":["import { type PageElement } from '../../../../types';\nimport { EndpointType } from '../../../../types/Endpoint';\nimport type View from '../View';\nimport ViewHelper from '../ViewHelper';\nimport BaseRenderer, { type RenderedListItem } from './BaseRenderer';\n\nconst ENDPOINT_TYPES = [ EndpointType.Browse,\n  EndpointType.Search,\n  EndpointType.BrowseContinuation,\n  EndpointType.SearchContinuation ];\n\ninterface OptionValueRendererListItemOptions {\n  extraUriParams: Record<string, any>;\n}\n\nexport default class OptionValueRenderer extends BaseRenderer<PageElement.Option['optionValues'][0]> {\n\n  #baseUri: string;\n  #prevUri: string;\n\n  renderToListItem(data: PageElement.Option['optionValues'][0], opts?: OptionValueRendererListItemOptions): RenderedListItem | null {\n    const view = this.currentView;\n    const baseUri = this.#getBaseUri();\n    const prevUri = this.#getPrevUri();\n\n    let valueUri: string;\n    if (data.endpoint?.type && ENDPOINT_TYPES.includes(data.endpoint.type)) {\n      let targetView: View;\n      if (view.genericViewUri) {\n        targetView = ViewHelper.getViewFromUriSegment(view.genericViewUri);\n      }\n      else {\n        targetView = {\n          name: 'generic'\n        };\n      }\n\n      // MusicFolderView types store browse endpoint in `endpoints` obj\n      if (Reflect.has(targetView, 'endpoints') && Reflect.has(targetView.endpoints, 'browse')) {\n        targetView.endpoints.browse = data.endpoint;\n      }\n      else {\n        targetView.endpoint = data.endpoint;\n      }\n\n      if (opts?.extraUriParams) {\n        for (const [ key, value ] of Object.entries(opts.extraUriParams)) {\n          targetView[key] = value;\n        }\n      }\n\n      valueUri = `${baseUri}/${ViewHelper.constructUriSegmentFromView(targetView)}`;\n    }\n    else if (data.selected) {\n      valueUri = prevUri;\n    }\n    else {\n      valueUri = baseUri;\n    }\n\n    return {\n      service: 'ytmusic',\n      type: 'item-no-menu',\n      title: data.text,\n      icon: data.selected ? 'fa fa-check' : 'fa',\n      uri: valueUri\n    };\n  }\n\n  #getBaseUri() {\n    if (!this.#baseUri) {\n      const baseUriViews = [ ...this.previousViews ];\n      baseUriViews.pop();\n      this.#baseUri = ViewHelper.constructUriFromViews(baseUriViews) || 'ytmusic';\n    }\n    return this.#baseUri;\n  }\n\n  #getPrevUri() {\n    if (!this.#prevUri) {\n      this.#prevUri = ViewHelper.constructPrevUri(this.currentView, this.previousViews);\n    }\n    return this.#prevUri;\n  }\n}\n"]}