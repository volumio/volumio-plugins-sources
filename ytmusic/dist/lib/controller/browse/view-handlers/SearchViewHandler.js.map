{"version":3,"file":"SearchViewHandler.js","sourceRoot":"","sources":["../../../../../src/lib/controller/browse/view-handlers/SearchViewHandler.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,6EAA8C;AAE9C,sDAAmM;AAGnM,kFAA0D;AAC1D,8EAA2E;AAO3E,MAAqB,iBAAkB,SAAQ,4BAA8B;IAA7E;;;IAgFA,CAAC;IA5EC,6DAA6D;IACnD,WAAW,CAAC,OAA6B;QACjD,MAAM,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC;QAC9B,IAAI,CAAC,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;YACxC,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;YAClD,IAAI,KAAK,EAAE;gBACT,MAAM,QAAQ,GAAa;oBACzB,IAAI,EAAE,uBAAY,CAAC,MAAM;oBACzB,OAAO,EAAE;wBACP,KAAK;qBACN;iBACF,CAAC;gBACF,OAAO,QAAQ,CAAC;aACjB;YAED,OAAO,IAAI,CAAC;SACb;QAED,OAAO,KAAK,CAAC,WAAW,EAAE,CAAC;IAC7B,CAAC;IAES,KAAK,CAAC,WAAW;QACzB,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,WAAW,EAAE,CAAC;QAC3C,MAAM,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC;QAE9B,8EAA8E;QAC9E,sFAAsF;QACtF,IAAI,CAAC,CAAC,IAAI,CAAC,YAAY,IAAI,CAAC,wBAAc,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,uBAAY,CAAC,kBAAkB,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;YACnI,MAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;YACpC,IAAI,wBAAc,CAAC,MAAM,CAAC,QAAQ,EAAE,uBAAY,CAAC,MAAM,CAAC,EAAE;gBACxD,MAAM,KAAK,GAAG,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC;gBACrC,IAAI,KAAK,EAAE;oBACT,QAAQ,CAAC,MAAM,GAAG;wBAChB,IAAI,EAAE,QAAQ;wBACd,KAAK,EAAE,wBAAO,CAAC,OAAO,CAAC,sBAAsB,EAAE,KAAK,CAAC;qBACtD,CAAC;iBACH;aACF;SACF;QAED,IAAI,QAAQ,EAAE,QAAQ,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YAC5C,4EAA4E;YAC5E,eAAe;YACf,KAAK,MAAM,OAAO,IAAI,QAAQ,CAAC,QAAQ,EAAE;gBACvC,MAAM,qBAAqB,GAAG,uBAAA,IAAI,gFAAyB,MAA7B,IAAI,EAA0B,OAAO,CAAC,CAAC;gBACrE,IAAI,qBAAqB,EAAE;oBACzB,QAAQ,CAAC,QAAQ,CAAC,OAAO,CAAC;wBACxB,IAAI,EAAE,SAAS;wBACf,KAAK,EAAE,qBAAqB;qBAC7B,CAAC,CAAC;oBACH,MAAM;iBACP;aACF;SACF;QAED,OAAO,QAAQ,CAAC;IAClB,CAAC;CAoBF;AAhFD,oCAgFC;+IAlB0B,OAA4B;IACnD,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,MAAM,EAAE;QAC1B,OAAO,IAAI,CAAC;KACb;IAED,IAAI,OAAO,GAAyB,IAAI,CAAC;IACzC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,SAAS,EAAE,EAAE;QACrC,IAAI,IAAI,CAAC,IAAI,KAAK,SAAS,EAAE;YAC3B,OAAO,GAAG,uBAAA,IAAI,gFAAyB,MAA7B,IAAI,EAA0B,IAAI,CAAC,CAAC;SAC/C;aACI,IAAI,IAAI,CAAC,IAAI,KAAK,cAAc,IAAI,IAAI,CAAC,IAAI,KAAK,yBAAyB,EAAE;YAChF,OAAO,GAAG,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;SAC9C;QACD,OAAO,CAAC,CAAC,OAAO,CAAC;IACnB,CAAC,CAAC,CAAC;IAEH,OAAO,OAAO,CAAC;AACjB,CAAC","sourcesContent":["import ytmusic from '../../../YTMusicContext';\nimport { PageElement } from '../../../types';\nimport Endpoint, { BrowseContinuationEndpoint, BrowseEndpoint, EndpointType, SearchContinuationEndpoint, SearchEndpoint, WatchContinuationEndpoint, WatchEndpoint } from '../../../types/Endpoint';\nimport { PageContent } from '../../../types/Content';\nimport { SectionItem } from '../../../types/PageElement';\nimport EndpointHelper from '../../../util/EndpointHelper';\nimport GenericViewHandler, { GenericViewBase } from './GenericViewHandler';\n\nexport interface SearchView extends GenericViewBase {\n  name: 'search';\n  query: string;\n}\n\nexport default class SearchViewHandler extends GenericViewHandler<SearchView> {\n\n  protected getEndpoint(explode: true): WatchEndpoint | BrowseEndpoint | WatchContinuationEndpoint | null;\n  protected getEndpoint(explode?: false | undefined): BrowseEndpoint | BrowseContinuationEndpoint | SearchEndpoint | SearchContinuationEndpoint | null;\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  protected getEndpoint(explode?: boolean | undefined): Endpoint | null {\n    const view = this.currentView;\n    if (!view.continuation && !view.endpoint) {\n      const query = view.query ? view.query.trim() : '';\n      if (query) {\n        const endpoint: Endpoint = {\n          type: EndpointType.Search,\n          payload: {\n            query\n          }\n        };\n        return endpoint;\n      }\n\n      return null;\n    }\n\n    return super.getEndpoint();\n  }\n\n  protected async getContents(): Promise<PageContent> {\n    const contents = await super.getContents();\n    const view = this.currentView;\n\n    // There should be no header for search results. We can insert our title here.\n    // If viewing continuation results, then the title would be in the continuationBundle.\n    if ((!view.continuation || !EndpointHelper.isType(view.continuation.endpoint, EndpointType.SearchContinuation)) && !contents.header) {\n      const endpoint = this.getEndpoint();\n      if (EndpointHelper.isType(endpoint, EndpointType.Search)) {\n        const query = endpoint.payload.query;\n        if (query) {\n          contents.header = {\n            type: 'search',\n            title: ytmusic.getI18n('YTMUSIC_SEARCH_TITLE', query)\n          };\n        }\n      }\n    }\n\n    if (contents?.sections && !view.continuation) {\n      // Extract 'Showing Results For' endpoint item. If it exists, move it to its\n      // Own section.\n      for (const section of contents.sections) {\n        const showingResultsForItem = this.#spliceShowingResultsFor(section);\n        if (showingResultsForItem) {\n          contents.sections.unshift({\n            type: 'section',\n            items: showingResultsForItem\n          });\n          break;\n        }\n      }\n    }\n\n    return contents;\n  }\n\n  #spliceShowingResultsFor(section: PageElement.Section): SectionItem[] | null {\n    if (!section.items?.length) {\n      return null;\n    }\n\n    let spliced: SectionItem[] | null = null;\n    section.items.some((item, itemIndex) => {\n      if (item.type === 'section') {\n        spliced = this.#spliceShowingResultsFor(item);\n      }\n      else if (item.type === 'endpointLink' && item.icon === 'YT2_SHOWING_RESULTS_FOR') {\n        spliced = section.items.splice(itemIndex, 1);\n      }\n      return !!spliced;\n    });\n\n    return spliced;\n  }\n}\n"]}