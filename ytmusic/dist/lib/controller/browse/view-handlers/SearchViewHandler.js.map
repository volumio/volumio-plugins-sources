{"version":3,"file":"SearchViewHandler.js","sourceRoot":"","sources":["../../../../../src/lib/controller/browse/view-handlers/SearchViewHandler.ts"],"names":[],"mappings":"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","sourcesContent":["import ytmusic from '../../../YTMusicContext';\nimport { type PageElement } from '../../../types';\nimport {type BrowseContinuationEndpoint, type BrowseEndpoint, type SearchContinuationEndpoint, type SearchEndpoint, type WatchContinuationEndpoint, type WatchEndpoint} from '../../../types/Endpoint';\nimport type Endpoint from '../../../types/Endpoint';\nimport { EndpointType } from '../../../types/Endpoint';\nimport { type PageContent } from '../../../types/Content';\nimport { type SectionItem } from '../../../types/PageElement';\nimport EndpointHelper from '../../../util/EndpointHelper';\nimport GenericViewHandler, { type GenericViewBase } from './GenericViewHandler';\n\nexport interface SearchView extends GenericViewBase {\n  name: 'search';\n  query: string;\n}\n\nexport default class SearchViewHandler extends GenericViewHandler<SearchView> {\n\n  protected getEndpoint(explode: true): WatchEndpoint | BrowseEndpoint | WatchContinuationEndpoint | null;\n  protected getEndpoint(explode?: false  ): BrowseEndpoint | BrowseContinuationEndpoint | SearchEndpoint | SearchContinuationEndpoint | null;\n   \n  protected getEndpoint(_explode?: boolean  ): Endpoint | null {\n    const view = this.currentView;\n    if (!view.continuation && !view.endpoint) {\n      const query = view.query ? view.query.trim() : '';\n      if (query) {\n        const endpoint: Endpoint = {\n          type: EndpointType.Search,\n          payload: {\n            query\n          }\n        };\n        return endpoint;\n      }\n\n      return null;\n    }\n\n    return super.getEndpoint();\n  }\n\n  protected async getContents(): Promise<PageContent> {\n    const contents = await super.getContents();\n    const view = this.currentView;\n\n    // There should be no header for search results. We can insert our title here.\n    // If viewing continuation results, then the title would be in the continuationBundle.\n    if ((!view.continuation || !EndpointHelper.isType(view.continuation.endpoint, EndpointType.SearchContinuation)) && !contents.header) {\n      const endpoint = this.getEndpoint();\n      if (EndpointHelper.isType(endpoint, EndpointType.Search)) {\n        const query = endpoint.payload.query;\n        if (query) {\n          contents.header = {\n            type: 'search',\n            title: ytmusic.getI18n('YTMUSIC_SEARCH_TITLE', query)\n          };\n        }\n      }\n    }\n\n    if (contents?.sections && !view.continuation) {\n      // Extract 'Showing Results For' endpoint item. If it exists, move it to its\n      // Own section.\n      for (const section of contents.sections) {\n        const showingResultsForItem = this.#spliceShowingResultsFor(section);\n        if (showingResultsForItem) {\n          contents.sections.unshift({\n            type: 'section',\n            items: showingResultsForItem\n          });\n          break;\n        }\n      }\n    }\n\n    return contents;\n  }\n\n  #spliceShowingResultsFor(section: PageElement.Section): SectionItem[] | null {\n    if (!section.items?.length) {\n      return null;\n    }\n\n    let spliced: SectionItem[] | null = null;\n    section.items.some((item, itemIndex) => {\n      if (item.type === 'section') {\n        spliced = this.#spliceShowingResultsFor(item);\n      }\n      else if (item.type === 'endpointLink' && item.icon === 'YT2_SHOWING_RESULTS_FOR') {\n        spliced = section.items.splice(itemIndex, 1);\n      }\n      return !!spliced;\n    });\n\n    return spliced;\n  }\n}\n"]}