{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport libQ from 'kew';\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport vconf from 'v-conf';\n\nimport ytmusic from './lib/YTMusicContext';\nimport BrowseController from './lib/controller/browse/BrowseController';\nimport SearchController, { SearchQuery } from './lib/controller/search/SearchController';\nimport PlayController from './lib/controller/play/PlayController';\nimport { jsPromiseToKew } from './lib/util';\nimport { AuthStatus } from './lib/util/Auth';\nimport Model, { ModelType } from './lib/model';\nimport { Account, I18nOptionValue, I18nOptions } from './lib/types/PluginConfig';\nimport { QueueItem } from './lib/controller/browse/view-handlers/ExplodableViewHandler';\nimport ViewHelper from './lib/controller/browse/view-handlers/ViewHelper';\nimport InnertubeLoader from './lib/model/InnertubeLoader';\nimport YTMusicNowPlayingMetadataProvider from './lib/util/YTMusicNowPlayingMetadataProvider';\nimport { NowPlayingPluginSupport } from 'now-playing-common';\n\ninterface GotoParams extends QueueItem {\n  type: 'album' | 'artist';\n}\n\nclass ControllerYTMusic implements NowPlayingPluginSupport {\n  #context: any;\n  #config: any;\n  #commandRouter: any;\n\n  #browseController: BrowseController | null;\n  #searchController: SearchController | null;\n  #playController: PlayController | null;\n\n  #nowPlayingMetadataProvider: YTMusicNowPlayingMetadataProvider | null;\n\n  constructor(context: any) {\n    this.#context = context;\n    this.#commandRouter = context.coreCommand;\n  }\n\n  getUIConfig() {\n    const defer = libQ.defer();\n\n    const langCode = this.#commandRouter.sharedVars.get('language_code');\n    const loadConfigPromises = [\n      this.#commandRouter.i18nJson(`${__dirname}/i18n/strings_${langCode}.json`,\n        `${__dirname}/i18n/strings_en.json`,\n        `${__dirname}/UIConfig.json`),\n      this.#getConfigI18nOptions(),\n      this.#getConfigAccountInfo(),\n      this.#getAuthStatus()\n    ];\n\n    libQ.all(loadConfigPromises)\n      .then(([ uiconf, i18nOptions, account, authStatus ]: any) => {\n        const i18nUIConf = uiconf.sections[0];\n        const accountUIConf = uiconf.sections[1];\n        const browseUIConf = uiconf.sections[2];\n        const playbackUIConf = uiconf.sections[3];\n\n        // I18n\n        // -- region\n        i18nUIConf.content[0].label = i18nOptions.options.region.label;\n        i18nUIConf.content[0].options = i18nOptions.options.region.optionValues;\n        i18nUIConf.content[0].value = i18nOptions.selected.region;\n        i18nUIConf.content[1].label = i18nOptions.options.language.label;\n        i18nUIConf.content[1].options = i18nOptions.options.language.optionValues;\n        i18nUIConf.content[1].value = i18nOptions.selected.language;\n\n        // Account\n        let authStatusDescription;\n        switch (authStatus.status) {\n          case AuthStatus.SignedIn:\n            if (account) {\n              authStatusDescription = ytmusic.getI18n('YTMUSIC_AUTH_STATUS_SIGNED_IN_AS', (account as Account).name);\n            }\n            else {\n              authStatusDescription = ytmusic.getI18n('YTMUSIC_AUTH_STATUS_SIGNED_IN');\n            }\n            break;\n          case AuthStatus.SigningIn:\n            authStatusDescription = ytmusic.getI18n('YTMUSIC_AUTH_STATUS_SIGNING_IN');\n            break;\n          case AuthStatus.Error:\n            authStatusDescription = ytmusic.getI18n('YTMUSIC_AUTH_STATUS_ERROR',\n              ytmusic.getErrorMessage('', authStatus.error, false));\n            break;\n          default: // AuthStatus.SignedOut\n            authStatusDescription = ytmusic.getI18n('YTMUSIC_AUTH_STATUS_SIGNED_OUT');\n        }\n\n        if (authStatus.status === AuthStatus.SignedOut) {\n          if (authStatus.verificationInfo) {\n            authStatusDescription += ` ${ytmusic.getI18n('YTMUSIC_AUTH_STATUS_CODE_READY')}`;\n\n            accountUIConf.content = [\n              {\n                id: 'verificationUrl',\n                type: 'text',\n                element: 'input',\n                label: ytmusic.getI18n('YTMUSIC_VERIFICATION_URL'),\n                value: authStatus.verificationInfo.verificationUrl\n              },\n              {\n                id: 'openVerificationUrl',\n                element: 'button',\n                label: ytmusic.getI18n('YTMUSIC_GO_TO_VERIFICATION_URL'),\n                onClick: {\n                  type: 'openUrl',\n                  url: authStatus.verificationInfo.verificationUrl\n                }\n              },\n              {\n                id: 'code',\n                type: 'text',\n                element: 'input',\n                label: ytmusic.getI18n('YTMUSIC_DEVICE_CODE'),\n                value: authStatus.verificationInfo.userCode\n              }\n            ];\n          }\n          else {\n            authStatusDescription += ` ${ytmusic.getI18n('YTMUSIC_AUTH_STATUS_CODE_PENDING')}`;\n          }\n        }\n        else if (authStatus.status === AuthStatus.SignedIn) {\n          accountUIConf.content = [\n            {\n              id: 'signOut',\n              element: 'button',\n              label: ytmusic.getI18n('YTMUSIC_SIGN_OUT'),\n              onClick: {\n                type: 'emit',\n                message: 'callMethod',\n                data: {\n                  endpoint: 'music_service/ytmusic',\n                  method: 'configSignOut'\n                }\n              }\n            }\n          ];\n        }\n\n        accountUIConf.description = authStatusDescription;\n\n        // Browse\n        const loadFullPlaylists = ytmusic.getConfigValue('loadFullPlaylists');\n        browseUIConf.content[0].value = loadFullPlaylists;\n\n        // Playback\n        const autoplay = ytmusic.getConfigValue('autoplay');\n        const autoplayClearQueue = ytmusic.getConfigValue('autoplayClearQueue');\n        const addToHistory = ytmusic.getConfigValue('addToHistory');\n        const prefetchEnabled = ytmusic.getConfigValue('prefetch');\n        const preferOpus = ytmusic.getConfigValue('preferOpus');\n        playbackUIConf.content[0].value = autoplay;\n        playbackUIConf.content[1].value = autoplayClearQueue;\n        playbackUIConf.content[2].value = addToHistory;\n        playbackUIConf.content[3].value = prefetchEnabled;\n        playbackUIConf.content[4].value = preferOpus;\n\n        defer.resolve(uiconf);\n      })\n      .fail((error: any) => {\n        ytmusic.getLogger().error(`[ytmusic] getUIConfig(): Cannot populate YouTube Music configuration - ${error}`);\n        defer.reject(Error());\n      }\n      );\n\n    return defer.promise;\n  }\n\n  onVolumioStart() {\n    const configFile = this.#commandRouter.pluginManager.getConfigurationFile(this.#context, 'config.json');\n    this.#config = new vconf();\n    this.#config.loadFile(configFile);\n    return libQ.resolve();\n  }\n\n  onStart() {\n    ytmusic.init(this.#context, this.#config);\n\n    this.#browseController = new BrowseController();\n    this.#searchController = new SearchController();\n    this.#playController = new PlayController();\n\n    this.#nowPlayingMetadataProvider = new YTMusicNowPlayingMetadataProvider();\n\n    this.#addToBrowseSources();\n\n    return libQ.resolve();\n  }\n\n  onStop() {\n    this.#commandRouter.volumioRemoveToBrowseSources('YouTube Music');\n\n    this.#playController?.reset();\n\n    this.#browseController = null;\n    this.#searchController = null;\n    this.#playController = null;\n\n    this.#nowPlayingMetadataProvider = null;\n\n    InnertubeLoader.reset();\n    ytmusic.reset();\n\n    return libQ.resolve();\n  }\n\n  getConfigurationFiles() {\n    return [ 'config.json' ];\n  }\n\n  #getConfigI18nOptions() {\n    const defer = libQ.defer();\n\n    const model = Model.getInstance(ModelType.Config);\n    model.getI18nOptions().then((options) => {\n      const selectedValues = {\n        region: ytmusic.getConfigValue('region'),\n        language: ytmusic.getConfigValue('language')\n      };\n      const selected: Record<keyof I18nOptions, I18nOptionValue> = {\n        region: { label: '', value: '' },\n        language: { label: '', value: '' }\n      };\n      (Object.keys(selected) as (keyof I18nOptions)[]).forEach((key) => {\n        selected[key] = options[key]?.optionValues.find((ov) => ov.value === selectedValues[key]) || { label: '', value: selectedValues[key] };\n      });\n\n      defer.resolve({\n        options,\n        selected\n      });\n    });\n\n    return defer.promise;\n  }\n\n  #getConfigAccountInfo() {\n    const defer = libQ.defer();\n\n    const model = Model.getInstance(ModelType.Account);\n    model.getInfo().then((account) => {\n      defer.resolve(account);\n    })\n      .catch((error) => {\n        ytmusic.getLogger().warn(`Failed to get account config: ${error}`);\n        defer.resolve(null);\n      });\n\n    return defer.promise;\n  }\n\n  #getAuthStatus() {\n    const defer = libQ.defer();\n\n    InnertubeLoader.getInstance().then(({ auth }) => {\n      defer.resolve(auth.getStatus());\n    })\n      .catch((error) => {\n        ytmusic.getLogger().warn(`Failed to get auth status: ${error}`);\n        defer.resolve(null);\n      });\n\n    return defer.promise;\n  }\n\n  configSaveI18n(data: any) {\n    const oldRegion = ytmusic.hasConfigKey('region') ? ytmusic.getConfigValue('region') : null;\n    const oldLanguage = ytmusic.hasConfigKey('language') ? ytmusic.getConfigValue('language') : null;\n    const region = data.region.value;\n    const language = data.language.value;\n\n    if (oldRegion !== region || oldLanguage !== language) {\n      ytmusic.setConfigValue('region', region);\n      ytmusic.setConfigValue('language', language);\n\n      InnertubeLoader.applyI18nConfig();\n      Model.getInstance(ModelType.Config).clearCache();\n      ytmusic.refreshUIConfig();\n    }\n\n    ytmusic.toast('success', ytmusic.getI18n('YTMUSIC_SETTINGS_SAVED'));\n  }\n\n  async configSignOut() {\n    if (InnertubeLoader.hasInstance()) {\n      const { auth } = await InnertubeLoader.getInstance();\n      auth.signOut();\n    }\n  }\n\n  configSaveBrowse(data: any) {\n    ytmusic.setConfigValue('loadFullPlaylists', data.loadFullPlaylists);\n\n    ytmusic.toast('success', ytmusic.getI18n('YTMUSIC_SETTINGS_SAVED'));\n  }\n\n  configSavePlayback(data: any) {\n    ytmusic.setConfigValue('autoplay', data.autoplay);\n    ytmusic.setConfigValue('autoplayClearQueue', data.autoplayClearQueue);\n    ytmusic.setConfigValue('addToHistory', data.addToHistory);\n    ytmusic.setConfigValue('prefetch', data.prefetch);\n    ytmusic.setConfigValue('preferOpus', data.preferOpus);\n\n    ytmusic.toast('success', ytmusic.getI18n('YTMUSIC_SETTINGS_SAVED'));\n  }\n\n  #addToBrowseSources() {\n    const source = {\n      name: 'YouTube Music',\n      uri: 'ytmusic',\n      plugin_type: 'music_service',\n      plugin_name: 'ytmusic',\n      albumart: '/albumart?sourceicon=music_service/ytmusic/dist/assets/images/ytmusic-mono-s.png'\n    };\n    this.#commandRouter.volumioAddToBrowseSources(source);\n  }\n\n  handleBrowseUri(uri: string) {\n    if (!this.#browseController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return jsPromiseToKew(this.#browseController.browseUri(uri));\n  }\n\n  explodeUri(uri: string) {\n    if (!this.#browseController) {\n      return libQ.reject('YouTube Music Discover plugin is not started');\n    }\n    return jsPromiseToKew(this.#browseController.explodeUri(uri));\n  }\n\n  clearAddPlayTrack(track: any) {\n    if (!this.#playController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return jsPromiseToKew(this.#playController.clearAddPlayTrack(track));\n  }\n\n  stop() {\n    if (!this.#playController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return this.#playController.stop();\n  }\n\n  pause() {\n    if (!this.#playController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return this.#playController.pause();\n  }\n\n  resume() {\n    if (!this.#playController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return this.#playController.resume();\n  }\n\n  seek(position: number) {\n    if (!this.#playController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return this.#playController.seek(position);\n  }\n\n  next() {\n    if (!this.#playController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return this.#playController.next();\n  }\n\n  previous() {\n    if (!this.#playController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return this.#playController.previous();\n  }\n\n  search(query: SearchQuery) {\n    if (!this.#searchController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return jsPromiseToKew(this.#searchController.search(query));\n  }\n\n  prefetch(track: QueueItem) {\n    if (!this.#playController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return jsPromiseToKew(this.#playController.prefetch(track));\n  }\n\n  goto(data: GotoParams) {\n    if (!this.#playController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n\n    const defer = libQ.defer();\n\n    this.#playController.getGotoUri(data.type, data.uri).then((uri) => {\n      if (uri) {\n        if (!this.#browseController) {\n          return libQ.reject('YouTube Music plugin is not started');\n        }\n        defer.resolve(this.#browseController.browseUri(uri));\n      }\n      else {\n        const view = ViewHelper.getViewsFromUri(data.uri)?.[1];\n        const trackData = view?.explodeTrackData || null;\n        const trackTitle = trackData?.title;\n        let errMsg;\n        if (data.type === 'album') {\n          errMsg = trackTitle ? ytmusic.getI18n('YTMUSIC_ERR_GOTO_ALBUM_NOT_FOUND_FOR', trackTitle) :\n            ytmusic.getI18n('YTMUSIC_ERR_GOTO_ALBUM_NOT_FOUND');\n        }\n        else if (data.type === 'artist') {\n          errMsg = trackTitle ? ytmusic.getI18n('YTMUSIC_ERR_GOTO_ARTIST_NOT_FOUND_FOR', trackTitle) :\n            ytmusic.getI18n('YTMUSIC_ERR_GOTO_ARTIST_NOT_FOUND');\n        }\n        else {\n          errMsg = ytmusic.getI18n('YTMUSIC_ERR_GOTO_UNKNOWN_TYPE', data.type);\n        }\n\n        ytmusic.toast('error', errMsg);\n        defer.reject(Error(errMsg));\n      }\n    });\n\n    return defer.promise;\n  }\n\n  getNowPlayingMetadataProvider() {\n    return this.#nowPlayingMetadataProvider;\n  }\n}\n\nexport = ControllerYTMusic;\n"]}