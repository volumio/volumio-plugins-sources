{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport libQ from 'kew';\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport vconf from 'v-conf';\n\nimport ytmusic from './lib/YTMusicContext';\nimport BrowseController from './lib/controller/browse/BrowseController';\nimport SearchController, { type SearchQuery } from './lib/controller/search/SearchController';\nimport PlayController from './lib/controller/play/PlayController';\nimport { jsPromiseToKew, kewToJSPromise } from './lib/util';\nimport Model, { ModelType } from './lib/model';\nimport { type I18nOptionValue, type I18nOptions } from './lib/types/PluginConfig';\nimport { type QueueItem } from './lib/controller/browse/view-handlers/ExplodableViewHandler';\nimport ViewHelper from './lib/controller/browse/view-handlers/ViewHelper';\nimport InnertubeLoader from './lib/model/InnertubeLoader';\nimport YTMusicNowPlayingMetadataProvider from './lib/util/YTMusicNowPlayingMetadataProvider';\nimport { type NowPlayingPluginSupport } from 'now-playing-common';\nimport { Parser } from 'volumio-youtubei.js';\n\ninterface GotoParams extends QueueItem {\n  type: 'album' | 'artist';\n}\n\nclass ControllerYTMusic implements NowPlayingPluginSupport {\n  #context: any;\n  #config: any;\n  #commandRouter: any;\n\n  #browseController: BrowseController | null;\n  #searchController: SearchController | null;\n  #playController: PlayController | null;\n\n  #nowPlayingMetadataProvider: YTMusicNowPlayingMetadataProvider | null;\n\n  constructor(context: any) {\n    this.#context = context;\n    this.#commandRouter = context.coreCommand;\n  }\n\n  getUIConfig() {\n    const defer = libQ.defer();\n\n    const langCode = this.#commandRouter.sharedVars.get('language_code');\n    const loadConfigPromises = [\n      kewToJSPromise(this.#commandRouter.i18nJson(`${__dirname}/i18n/strings_${langCode}.json`,\n        `${__dirname}/i18n/strings_en.json`,\n        `${__dirname}/UIConfig.json`)),\n      this.#getConfigI18nOptions(),\n      this.#getConfigAccountInfo()\n    ] as const;\n\n    Promise.all(loadConfigPromises)\n      .then(([ uiconf, i18nOptions, account ]) => {\n        const i18nUIConf = uiconf.sections[0];\n        const accountUIConf = uiconf.sections[1];\n        const browseUIConf = uiconf.sections[2];\n        const playbackUIConf = uiconf.sections[3];\n\n        // I18n\n        // -- region\n        i18nUIConf.content[0].label = i18nOptions.options.region.label;\n        i18nUIConf.content[0].options = i18nOptions.options.region.optionValues;\n        i18nUIConf.content[0].value = i18nOptions.selected.region;\n        i18nUIConf.content[1].label = i18nOptions.options.language.label;\n        i18nUIConf.content[1].options = i18nOptions.options.language.optionValues;\n        i18nUIConf.content[1].value = i18nOptions.selected.language;\n\n        // Account\n        const cookie = ytmusic.getConfigValue('cookie');\n        let authStatusDescription;\n        if (account?.isSignedIn && account.active) {\n          authStatusDescription = ytmusic.getI18n('YTMUSIC_AUTH_STATUS_SIGNED_IN_AS', account.active.name);\n          if (account.list.length > 1) {\n            const accountSelect = {\n              id: 'activeChannelHandle',\n              element: 'select',\n              label: ytmusic.getI18n('YTMUSIC_ACTIVE_CHANNEL'),\n              value: {\n                label: account.active.name,\n                value: account.active.handle\n              },\n              options: account.list.map((ac) => ({\n                label: ac.name,\n                value: ac.handle\n              }))\n            };\n            accountUIConf.content = [\n              accountUIConf.content[0],\n              accountSelect,\n              ...accountUIConf.content.slice(1)\n            ];\n            accountUIConf.saveButton.data.push('activeChannelHandle');\n          }\n        }\n        else if (cookie) {\n          authStatusDescription = ytmusic.getI18n('YTMUSIC_AUTH_STATUS_SIGNED_OUT');\n        }\n        accountUIConf.description = authStatusDescription;\n        accountUIConf.content[0].value = cookie;\n\n        // Browse\n        const loadFullPlaylists = ytmusic.getConfigValue('loadFullPlaylists');\n        browseUIConf.content[0].value = loadFullPlaylists;\n\n        // Playback\n        const autoplay = ytmusic.getConfigValue('autoplay');\n        const autoplayClearQueue = ytmusic.getConfigValue('autoplayClearQueue');\n        const addToHistory = ytmusic.getConfigValue('addToHistory');\n        const prefetchEnabled = ytmusic.getConfigValue('prefetch');\n        const preferOpus = ytmusic.getConfigValue('preferOpus');\n        playbackUIConf.content[0].value = autoplay;\n        playbackUIConf.content[1].value = autoplayClearQueue;\n        playbackUIConf.content[2].value = addToHistory;\n        playbackUIConf.content[3].value = prefetchEnabled;\n        playbackUIConf.content[4].value = preferOpus;\n\n        defer.resolve(uiconf);\n      })\n      .catch((error: unknown) => {\n        ytmusic.getLogger().error(ytmusic.getErrorMessage('[ytmusic] getUIConfig(): Cannot populate YouTube Music configuration:', error));\n        defer.reject(Error());\n      }\n      );\n\n    return defer.promise;\n  }\n\n  onVolumioStart() {\n    const configFile = this.#commandRouter.pluginManager.getConfigurationFile(this.#context, 'config.json');\n    this.#config = new vconf();\n    this.#config.loadFile(configFile);\n    return libQ.resolve();\n  }\n\n  onStart() {\n    ytmusic.init(this.#context, this.#config);\n\n    this.#browseController = new BrowseController();\n    this.#searchController = new SearchController();\n    this.#playController = new PlayController();\n\n    this.#nowPlayingMetadataProvider = new YTMusicNowPlayingMetadataProvider();\n    Parser.setParserErrorHandler(() => null); // Disable Innertube parser error reporting\n    \n    this.#addToBrowseSources();\n\n    return libQ.resolve();\n  }\n\n  onStop() {\n    this.#commandRouter.volumioRemoveToBrowseSources('YouTube Music');\n\n    this.#playController?.reset();\n\n    this.#browseController = null;\n    this.#searchController = null;\n    this.#playController = null;\n\n    this.#nowPlayingMetadataProvider = null;\n\n    InnertubeLoader.reset();\n    ytmusic.reset();\n\n    return libQ.resolve();\n  }\n\n  getConfigurationFiles() {\n    return [ 'config.json' ];\n  }\n\n  async #getConfigI18nOptions() {\n    const model = Model.getInstance(ModelType.Config);\n    const selected: Record<keyof I18nOptions, I18nOptionValue> = {\n      region: { label: '', value: '' },\n      language: { label: '', value: '' }\n    };\n    try {\n      const options = await model.getI18nOptions();\n      const selectedValues = {\n        region: ytmusic.getConfigValue('region'),\n        language: ytmusic.getConfigValue('language')\n      };\n      \n      (Object.keys(selected) as (keyof I18nOptions)[]).forEach((key) => {\n        selected[key] = options[key]?.optionValues.find((ov) => ov.value === selectedValues[key]) || { label: '', value: selectedValues[key] };\n      });\n\n      return {\n        options,\n        selected\n      };\n    }\n    catch (error: unknown) {\n      ytmusic.getLogger().error(ytmusic.getErrorMessage('[ytmusic] Error getting i18n options:', error));\n      ytmusic.toast('warning', 'Could not obtain i18n options');\n      return {\n        options: model.getDefaultI18nOptions(),\n        selected\n      };\n    }\n  }\n\n  #getConfigAccountInfo() {\n    const model = Model.getInstance(ModelType.Account);\n    try {\n      return model.getInfo();\n    }\n    catch (error: unknown) {\n      ytmusic.getLogger().warn(ytmusic.getErrorMessage('[ytmusic] Failed to get account config:', error));\n      return null;\n    }\n  }\n\n  configSaveI18n(data: any) {\n    const oldRegion = ytmusic.hasConfigKey('region') ? ytmusic.getConfigValue('region') : null;\n    const oldLanguage = ytmusic.hasConfigKey('language') ? ytmusic.getConfigValue('language') : null;\n    const region = data.region.value;\n    const language = data.language.value;\n\n    if (oldRegion !== region || oldLanguage !== language) {\n      ytmusic.setConfigValue('region', region);\n      ytmusic.setConfigValue('language', language);\n\n      InnertubeLoader.applyI18nConfig();\n      Model.getInstance(ModelType.Config).clearCache();\n      ytmusic.refreshUIConfig();\n    }\n\n    ytmusic.toast('success', ytmusic.getI18n('YTMUSIC_SETTINGS_SAVED'));\n  }\n\n  configSaveAccount(data: any) {\n    const oldCookie = ytmusic.hasConfigKey('cookie') ? ytmusic.getConfigValue('cookie') : null;\n    const cookie = data.cookie?.trim();\n    const oldActiveChannelHandle = ytmusic.getConfigValue('activeChannelHandle');\n    const activeChannelHandle = data.activeChannelHandle?.value || '';\n    let resetInnertube = false;\n    if (oldCookie !== cookie) {\n      ytmusic.setConfigValue('cookie', cookie);\n      ytmusic.deleteConfigValue('activeChannelHandle');\n      resetInnertube = true;\n    }\n    else if (oldActiveChannelHandle !== activeChannelHandle) {\n      ytmusic.setConfigValue('activeChannelHandle', activeChannelHandle);\n      resetInnertube =  true;\n    }\n    ytmusic.toast('success', ytmusic.getI18n('YTMUSIC_SETTINGS_SAVED'));\n    if (resetInnertube) {\n      InnertubeLoader.reset();\n      ytmusic.refreshUIConfig();\n    }\n  }\n\n  configSaveBrowse(data: any) {\n    ytmusic.setConfigValue('loadFullPlaylists', data.loadFullPlaylists);\n\n    ytmusic.toast('success', ytmusic.getI18n('YTMUSIC_SETTINGS_SAVED'));\n  }\n\n  configSavePlayback(data: any) {\n    ytmusic.setConfigValue('autoplay', data.autoplay);\n    ytmusic.setConfigValue('autoplayClearQueue', data.autoplayClearQueue);\n    ytmusic.setConfigValue('addToHistory', data.addToHistory);\n    ytmusic.setConfigValue('prefetch', data.prefetch);\n    ytmusic.setConfigValue('preferOpus', data.preferOpus);\n\n    ytmusic.toast('success', ytmusic.getI18n('YTMUSIC_SETTINGS_SAVED'));\n  }\n\n  #addToBrowseSources() {\n    const source = {\n      name: 'YouTube Music',\n      uri: 'ytmusic',\n      plugin_type: 'music_service',\n      plugin_name: 'ytmusic',\n      albumart: '/albumart?sourceicon=music_service/ytmusic/dist/assets/images/ytmusic-mono-s.png'\n    };\n    this.#commandRouter.volumioAddToBrowseSources(source);\n  }\n\n  handleBrowseUri(uri: string) {\n    if (!this.#browseController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return jsPromiseToKew(this.#browseController.browseUri(uri));\n  }\n\n  explodeUri(uri: string) {\n    if (!this.#browseController) {\n      return libQ.reject('YouTube Music Discover plugin is not started');\n    }\n    return jsPromiseToKew(this.#browseController.explodeUri(uri));\n  }\n\n  clearAddPlayTrack(track: any) {\n    if (!this.#playController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return jsPromiseToKew(this.#playController.clearAddPlayTrack(track));\n  }\n\n  stop() {\n    if (!this.#playController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return this.#playController.stop();\n  }\n\n  pause() {\n    if (!this.#playController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return this.#playController.pause();\n  }\n\n  resume() {\n    if (!this.#playController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return this.#playController.resume();\n  }\n\n  seek(position: number) {\n    if (!this.#playController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return this.#playController.seek(position);\n  }\n\n  next() {\n    if (!this.#playController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return this.#playController.next();\n  }\n\n  previous() {\n    if (!this.#playController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return this.#playController.previous();\n  }\n\n  search(query: SearchQuery) {\n    if (!this.#searchController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return jsPromiseToKew(this.#searchController.search(query));\n  }\n\n  prefetch(track: QueueItem) {\n    if (!this.#playController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n    return jsPromiseToKew(this.#playController.prefetch(track));\n  }\n\n  goto(data: GotoParams) {\n    if (!this.#playController) {\n      return libQ.reject('YouTube Music plugin is not started');\n    }\n\n    const defer = libQ.defer();\n\n    this.#playController.getGotoUri(data.type, data.uri).then((uri) => {\n      if (uri) {\n        if (!this.#browseController) {\n          return libQ.reject('YouTube Music plugin is not started');\n        }\n        defer.resolve(this.#browseController.browseUri(uri));\n      }\n      else {\n        const view = ViewHelper.getViewsFromUri(data.uri)?.[1];\n        const trackData = view?.explodeTrackData || null;\n        const trackTitle = trackData?.title;\n        let errMsg;\n        if (data.type === 'album') {\n          errMsg = trackTitle ? ytmusic.getI18n('YTMUSIC_ERR_GOTO_ALBUM_NOT_FOUND_FOR', trackTitle) :\n            ytmusic.getI18n('YTMUSIC_ERR_GOTO_ALBUM_NOT_FOUND');\n        }\n        else if (data.type === 'artist') {\n          errMsg = trackTitle ? ytmusic.getI18n('YTMUSIC_ERR_GOTO_ARTIST_NOT_FOUND_FOR', trackTitle) :\n            ytmusic.getI18n('YTMUSIC_ERR_GOTO_ARTIST_NOT_FOUND');\n        }\n        else {\n          errMsg = ytmusic.getI18n('YTMUSIC_ERR_GOTO_UNKNOWN_TYPE', data.type);\n        }\n\n        ytmusic.toast('error', errMsg);\n        defer.reject(Error(errMsg));\n      }\n    })\n    .catch((error: unknown) => {\n      ytmusic.getLogger().error(ytmusic.getErrorMessage('[ytmusic] Error obtaining goto URL:', error));\n    });\n\n    return defer.promise;\n  }\n\n  getNowPlayingMetadataProvider() {\n    return this.#nowPlayingMetadataProvider;\n  }\n}\n\nexport = ControllerYTMusic;\n"]}