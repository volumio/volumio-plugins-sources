{"version":3,"file":"OptionRenderer.js","sourceRoot":"","sources":["../../../../../../src/lib/controller/browse/view-handlers/renderers/OptionRenderer.ts"],"names":[],"mappings":"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","sourcesContent":["import { PageElement } from '../../../../types';\nimport { OptionSelectionView } from '../OptionSelectionViewHandler';\nimport { ContinuationBundle } from '../View';\nimport ViewHelper from '../ViewHelper';\nimport BaseRenderer, { RenderedListItem } from './BaseRenderer';\n\nconst EXCLUDE_VIEW_PARAMS = [ 'name', 'continuation', 'endpoint', 'continuationBundle' ];\n\nexport interface ContinuationBundleOption {\n  type: 'continuationBundleOption';\n  continuationBundle: ContinuationBundle;\n  targetKey: string;\n}\n\nexport default class OptionRenderer extends BaseRenderer<PageElement.Option | ContinuationBundleOption> {\n\n  renderToListItem(data: PageElement.Option | ContinuationBundleOption): RenderedListItem | null {\n    if (data.type === 'continuationBundleOption') {\n      return this.#renderContinuationBundleOptionToListItem(data as ContinuationBundleOption);\n    }\n\n    const optionData = data as PageElement.Option;\n    const selected = optionData.optionValues.find((ov) => ov.selected) || optionData.optionValues[0];\n\n    const targetView: OptionSelectionView = {\n      name: 'optionSelection',\n      genericViewUri: this.#getGenericViewUri(),\n      option: data\n    };\n\n    return {\n      service: 'youtube2',\n      type: 'item-no-menu',\n      title: selected.text,\n      icon: 'fa fa-angle-down',\n      uri: `${this.uri}/${ViewHelper.constructUriSegmentFromView(targetView)}`\n    };\n  }\n\n  #renderContinuationBundleOptionToListItem(data: ContinuationBundleOption): RenderedListItem | null {\n    const bundle = data.continuationBundle;\n    const keyParts = data.targetKey.split('.');\n    const option = keyParts.reduce<any>((targetValue, key) => targetValue[key], bundle);\n    if (typeof option === 'object' && option.type === 'option') {\n      const selected = (option as PageElement.Option).optionValues.find((ov) => ov.selected) || null;\n      const displayText = selected ? (option.title ? `${option.title}: ${selected.text}` : selected.text) : (option.title || option.optionValues[0].text);\n\n      const targetView: OptionSelectionView = {\n        name: 'optionSelection',\n        fromContinuationBundle: '1',\n        continuationBundle: bundle,\n        targetKey: data.targetKey,\n        genericViewUri: this.#getGenericViewUri()\n      };\n\n      return {\n        service: 'youtube2',\n        type: 'item-no-menu',\n        title: displayText,\n        icon: 'fa fa-angle-down',\n        uri: `${this.uri}/${ViewHelper.constructUriSegmentFromView(targetView)}`\n      };\n    }\n\n    return null;\n  }\n\n  #getGenericViewUri() {\n    const view = this.currentView;\n    const genericViewParams = Object.keys(view).reduce<Record<string, any>>((result, key) => {\n      if (!EXCLUDE_VIEW_PARAMS.includes(key)) {\n        result[key] = view[key];\n      }\n      return result;\n    }, {});\n    const genericView = {\n      name: view.name,\n      ...genericViewParams\n    };\n    return ViewHelper.constructUriSegmentFromView(genericView);\n  }\n}\n"]}