{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../src/lib/controller/browse/index.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,4EAAwC;AACxC,6EAAqD;AAKrD,4FAAoE;AAEpE,MAAqB,gBAAgB;IAArC;;IAoEA,CAAC;IAlEC;;;;;;;;;;;OAWG;IACH,KAAK,CAAC,SAAS,CAAC,GAAW;QACzB,yBAAG,CAAC,SAAS,EAAE,CAAC,IAAI,CAAC,gCAAgC,GAAG,EAAE,CAAC,CAAC;QAE5D,MAAM,OAAO,GAAG,uBAAA,IAAI,iEAAY,MAAhB,IAAI,EAAa,GAAG,CAAC,CAAC;QACtC,IAAI;YACF,OAAO,MAAM,OAAO,CAAC,MAAM,EAAE,CAAC;SAC/B;QACD,OAAO,KAAU,EAAE;YACjB,yBAAG,CAAC,SAAS,EAAE,CAAC,KAAK,CAAC,yBAAG,CAAC,eAAe,CAAC,EAAE,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC;YAC5D,MAAM,KAAK,CAAC;SACb;IACH,CAAC;IAED;;;;;;;;;;;;OAYG;IACH,KAAK,CAAC,UAAU,CAAC,GAAW;QAC1B,yBAAG,CAAC,SAAS,EAAE,CAAC,IAAI,CAAC,iCAAiC,GAAG,EAAE,CAAC,CAAC;QAE7D,IAAI,CAAC,uBAAa,CAAC,kBAAkB,CAAC,GAAG,CAAC,EAAE;YAC1C,0BAA0B;YAC1B,MAAM,YAAY,GAAG,MAAM,uBAAa,CAAC,uBAAuB,CAAC,GAAG,CAAC,CAAC;YACtE,IAAI,CAAC,YAAY,EAAE;gBACjB,yBAAG,CAAC,SAAS,EAAE,CAAC,KAAK,CAAC,4CAA4C,GAAG,EAAE,CAAC,CAAC;gBACzE,yBAAG,CAAC,KAAK,CAAC,OAAO,EAAE,yBAAG,CAAC,OAAO,CAAC,0BAA0B,CAAC,CAAC,CAAC;gBAC5D,MAAM,KAAK,CAAC,yBAAG,CAAC,OAAO,CAAC,0BAA0B,CAAC,CAAC,CAAC;aACtD;YACD,yBAAG,CAAC,SAAS,EAAE,CAAC,IAAI,CAAC,sDAAsD,YAAY,EAAE,CAAC,CAAC;YAC3F,OAAO,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;SACtC;QAED,MAAM,OAAO,GAAG,uBAAA,IAAI,iEAAY,MAAhB,IAAI,EAAa,GAAG,CAAC,CAAC;QACtC,IAAI;YACF,OAAO,MAAM,OAAO,CAAC,OAAO,EAAE,CAAC;SAChC;QACD,OAAO,KAAU,EAAE;YACjB,yBAAG,CAAC,SAAS,EAAE,CAAC,KAAK,CAAC,yBAAG,CAAC,eAAe,CAAC,EAAE,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC;YAC5D,MAAM,KAAK,CAAC;SACb;IACH,CAAC;CAKF;AApED,mCAoEC;kHAH6B,GAAW;IACrC,OAAO,4BAAkB,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;AAC5C,CAAC","sourcesContent":["import yt2 from '../../YouTube2Context';\nimport ExplodeHelper from '../../util/ExplodeHelper';\nimport BaseViewHandler from './view-handlers/BaseViewHandler';\nimport { QueueItem } from './view-handlers/ExplodableViewHandler';\nimport View from './view-handlers/View';\nimport { RenderedPage } from './view-handlers/ViewHandler';\nimport ViewHandlerFactory from './view-handlers/ViewHandlerFactory';\n\nexport default class BrowseController {\n\n  /*\n   *  Uri follows a hierarchical view structure, starting with 'youtube2'.\n   * - If nothing follows 'youtube2', the view would be 'root'.\n   *\n   * After 'youtube2/', the uri consists of segments representing the following views:\n   * - generic[@endpoint=...]\n   * - playlist[@endpoint=...]\n   * - search[@query=...] | [@endpoint=...[@continuation=...]]\n   * - (Supporting view) optionSelection[@option=...] | [@fromContinuationBundle=...@continuationBundle=...]\n   * ...\n   *\n   */\n  async browseUri(uri: string): Promise<RenderedPage> {\n    yt2.getLogger().info(`[youtube2-browse] browseUri: ${uri}`);\n\n    const handler = this.#getHandler(uri);\n    try {\n      return await handler.browse();\n    }\n    catch (error: any) {\n      yt2.getLogger().error(yt2.getErrorMessage('', error, true));\n      throw error;\n    }\n  }\n\n  /**\n   * Explodable uris:\n   * - video[@explodeTrackData=...]\n   * - playlist[@endpoint=...]\n   * - generic[@endpoint=...]\n   *\n   * Legacy (pre v1.0) uris:\n   * - video[@videoId=...][@fromPlaylistId=...]\n   * - videos[@playlistId=...]\n   * - playlists[@channelId=...]\n   *\n   * Legacy uris will be converted to current format\n   */\n  async explodeUri(uri: string): Promise<QueueItem[]> {\n    yt2.getLogger().info(`[youtube2-browse] explodeUri: ${uri}`);\n\n    if (!ExplodeHelper.validateExplodeUri(uri)) {\n      // Try convert from legacy\n      const convertedUri = await ExplodeHelper.convertLegacyExplodeUri(uri);\n      if (!convertedUri) {\n        yt2.getLogger().error(`[youtube2-browse] Could not explode URI: ${uri}`);\n        yt2.toast('error', yt2.getI18n('YOUTUBE2_ERR_INVALID_URI'));\n        throw Error(yt2.getI18n('YOUTUBE2_ERR_INVALID_URI'));\n      }\n      yt2.getLogger().info(`[youtube2-browse] Converted legacy explode URI to: ${convertedUri}`);\n      return this.explodeUri(convertedUri);\n    }\n\n    const handler = this.#getHandler(uri);\n    try {\n      return await handler.explode();\n    }\n    catch (error: any) {\n      yt2.getLogger().error(yt2.getErrorMessage('', error, true));\n      throw error;\n    }\n  }\n\n  #getHandler<V extends View>(uri: string): BaseViewHandler<V> {\n    return ViewHandlerFactory.getHandler(uri);\n  }\n}\n"]}